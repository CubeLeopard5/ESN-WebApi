§
SC:\Users\micha\Projects\ESN-WebApi\Web\Validators\UserPasswordChangeDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class *
UserPasswordChangeDtoValidator +
:, -
AbstractValidator. ?
<? @!
UserPasswordChangeDto@ U
>U V
{ 
public 
*
UserPasswordChangeDtoValidator )
() *
)* +
{		 
RuleFor

 
(

 
x

 
=>

 
x

 
.

 
OldPassword

 "
)

" #
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str ;
); <
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str T
)T U
;U V
RuleFor 
( 
x 
=> 
x 
. 
NewPassword "
)" #
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str =
)= >
. 
MinimumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str V
)V W
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str ^
)^ _
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str ^
)^ _
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str T
)T U
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str ^
)^ _
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str V
)V W
. 
NotEqual 
( 
x 
=> 
x 
. 
OldPassword (
)( )
.   
WithMessage   
(   
$str   R
)  R S
;  S T
}!! 
}"" ⁄.
KC:\Users\micha\Projects\ESN-WebApi\Web\Validators\UserCreateDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class "
UserCreateDtoValidator #
:$ %
AbstractValidator& 7
<7 8
UserCreateDto8 E
>E F
{ 
public 
"
UserCreateDtoValidator !
(! "
)" #
{		 
RuleFor

 
(

 
x

 
=>

 
x

 
.

 
Email

 
)

 
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str -
)- .
. 
EmailAddress 
( 
) 
. 
WithMessage 
( 
$str 3
)3 4
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str F
)F G
;G H
RuleFor 
( 
x 
=> 
x 
. 
Password 
)  
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str 5
)5 6
. 
MinimumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str N
)N O
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str V
)V W
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str V
)V W
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str L
)L M
. 
Matches 
( 
$str 
) 
. 
WithMessage 
( 
$str V
)V W
;W X
RuleFor   
(   
x   
=>   
x   
.   
	FirstName    
)    !
.!! 
NotEmpty!! 
(!! 
)!! 
."" 
WithMessage"" 
("" 
$str"" /
)""/ 0
.## 
MaximumLength## 
(## 
$num## 
)## 
.$$ 
WithMessage$$ 
($$ 
$str$$ H
)$$H I
;$$I J
RuleFor&& 
(&& 
x&& 
=>&& 
x&& 
.&& 
LastName&& 
)&&  
.'' 
NotEmpty'' 
('' 
)'' 
.(( 
WithMessage(( 
((( 
$str(( ,
)((, -
.)) 
MaximumLength)) 
()) 
$num)) 
))) 
.** 
WithMessage** 
(** 
$str** E
)**E F
;**F G
RuleFor,, 
(,, 
x,, 
=>,, 
x,, 
.,, 
	BirthDate,,  
),,  !
.-- 
NotEmpty-- 
(-- 
)-- 
... 
WithMessage.. 
(.. 
$str.. ;
)..; <
.// 
Must// 
(// 
BeAValidAge// 
)// 
.00 
WithMessage00 
(00 
$str00 ;
)00; <
;00< =
RuleFor22 
(22 
x22 
=>22 
x22 
.22 
PhoneNumber22 "
)22" #
.33 
MaximumLength33 
(33 
$num33 
)33 
.44 
WithMessage44 
(44 
$str44 T
)44T U
;44U V
RuleFor66 
(66 
x66 
=>66 
x66 
.66 
StudentType66 "
)66" #
.77 
NotEmpty77 
(77 
)77 
.88 
WithMessage88 
(88 
$str88 8
)888 9
.99 
Must99 
(99 
BeAValidStudentType99 %
)99% &
.:: 
WithMessage:: 
(:: 
$str:: [
)::[ \
;::\ ]
};; 
private== 
bool== 
BeAValidAge== 
(== 
DateTime== %
	birthDate==& /
)==/ 0
{>> 
var?? 
age?? 
=?? 
DateTime?? 
.?? 
Today??  
.??  !
Year??! %
-??& '
	birthDate??( 1
.??1 2
Year??2 6
;??6 7
if@@ 

(@@ 
	birthDate@@ 
>@@ 
DateTime@@  
.@@  !
Today@@! &
.@@& '
AddYears@@' /
(@@/ 0
-@@0 1
age@@1 4
)@@4 5
)@@5 6
ageAA 
--AA 
;AA 
returnCC 
ageCC 
>=CC 
$numCC 
;CC 
}DD 
privateFF 
boolFF 
BeAValidStudentTypeFF $
(FF$ %
stringFF% +
studentTypeFF, 7
)FF7 8
{GG 
varHH 

validTypesHH 
=HH 
newHH 
[HH 
]HH 
{HH  
$strHH! +
,HH+ ,
$strHH- 4
,HH4 5
$strHH6 B
}HHC D
;HHD E
returnII 

validTypesII 
.II 
ContainsII "
(II" #
studentTypeII# .
?II. /
.II/ 0
ToLowerInvariantII0 @
(II@ A
)IIA B
)IIB C
;IIC D
}JJ 
}KK ∫
NC:\Users\micha\Projects\ESN-WebApi\Web\Validators\RegisterEventDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class %
RegisterEventDtoValidator &
:' (
AbstractValidator) :
<: ;
RegisterEventDto; K
>K L
{ 
public		 
%
RegisterEventDtoValidator		 $
(		$ %
)		% &
{

 
RuleFor 
( 
x 
=> 
x 
. 
SurveyJsData #
)# $
. 
Must 
( 
BeValidJson 
) 
. 
When 
( 
x 
=> 
! 
string 
. 
IsNullOrEmpty ,
(, -
x- .
.. /
SurveyJsData/ ;
); <
)< =
. 
WithMessage 
( 
$str W
)W X
. 
MaximumLength 
( 
$num  
)  !
. 
When 
( 
x 
=> 
! 
string 
. 
IsNullOrEmpty ,
(, -
x- .
.. /
SurveyJsData/ ;
); <
)< =
. 
WithMessage 
( 
$str ^
)^ _
;_ `
} 
private 
bool 
BeValidJson 
( 
string #
?# $
json% )
)) *
{ 
if 

( 
string 
. 
IsNullOrWhiteSpace %
(% &
json& *
)* +
)+ ,
return 
true 
; 
try 
{ 	
using 
var 
doc 
= 
JsonDocument (
.( )
Parse) .
(. /
json/ 3
)3 4
;4 5
return 
true 
; 
} 	
catch 
( 
JsonException 
) 
{ 	
return   
false   
;   
}!! 	
}"" 
}## Â
NC:\Users\micha\Projects\ESN-WebApi\Web\Validators\EventTemplateDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class %
EventTemplateDtoValidator &
:' (
AbstractValidator) :
<: ;
EventTemplateDto; K
>K L
{ 
public		 
%
EventTemplateDtoValidator		 $
(		$ %
)		% &
{

 
RuleFor 
( 
x 
=> 
x 
. 
Title 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str .
). /
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str G
)G H
;H I
RuleFor 
( 
x 
=> 
x 
. 
Description "
)" #
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str 5
)5 6
;6 7
RuleFor 
( 
x 
=> 
x 
. 
SurveyJsData #
)# $
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str B
)B C
. 
Must 
( 
BeValidJson 
) 
. 
WithMessage 
( 
$str W
)W X
. 
MaximumLength 
( 
$num  
)  !
. 
WithMessage 
( 
$str ^
)^ _
;_ `
} 
private 
bool 
BeValidJson 
( 
string #
?# $
json% )
)) *
{ 
if   

(   
string   
.   
IsNullOrWhiteSpace   %
(  % &
json  & *
)  * +
)  + ,
return!! 
true!! 
;!! 
try## 
{$$ 	
using%% 
var%% 
doc%% 
=%% 
JsonDocument%% (
.%%( )
Parse%%) .
(%%. /
json%%/ 3
)%%3 4
;%%4 5
return&& 
true&& 
;&& 
}'' 	
catch(( 
((( 
JsonException(( 
)(( 
{)) 	
return** 
false** 
;** 
}++ 	
},, 
}-- ˝
TC:\Users\micha\Projects\ESN-WebApi\Web\Validators\CreateEventTemplateDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class +
CreateEventTemplateDtoValidator ,
:- .
AbstractValidator/ @
<@ A"
CreateEventTemplateDtoA W
>W X
{ 
public		 
+
CreateEventTemplateDtoValidator		 *
(		* +
)		+ ,
{

 
RuleFor 
( 
x 
=> 
x 
. 
Title 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str .
). /
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str G
)G H
;H I
RuleFor 
( 
x 
=> 
x 
. 
Description "
)" #
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str 5
)5 6
;6 7
RuleFor 
( 
x 
=> 
x 
. 
SurveyJsData #
)# $
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str B
)B C
. 
Must 
( 
BeValidJson 
) 
. 
WithMessage 
( 
$str W
)W X
. 
MaximumLength 
( 
$num  
)  !
. 
WithMessage 
( 
$str ^
)^ _
;_ `
} 
private 
bool 
BeValidJson 
( 
string #
?# $
json% )
)) *
{ 
if   

(   
string   
.   
IsNullOrWhiteSpace   %
(  % &
json  & *
)  * +
)  + ,
return!! 
true!! 
;!! 
try## 
{$$ 	
using%% 
var%% 
doc%% 
=%% 
JsonDocument%% (
.%%( )
Parse%%) .
(%%. /
json%%/ 3
)%%3 4
;%%4 5
return&& 
true&& 
;&& 
}'' 	
catch(( 
((( 
JsonException(( 
)(( 
{)) 	
return** 
false** 
;** 
}++ 	
},, 
}-- Á"
LC:\Users\micha\Projects\ESN-WebApi\Web\Validators\CreateEventDtoValidator.cs
	namespace 	
Web
 
. 

Validators 
; 
public 
class #
CreateEventDtoValidator $
:% &
AbstractValidator' 8
<8 9
CreateEventDto9 G
>G H
{ 
public		 
#
CreateEventDtoValidator		 "
(		" #
)		# $
{

 
RuleFor 
( 
x 
=> 
x 
. 
Title 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str .
). /
. 
MaximumLength 
( 
$num 
) 
. 
WithMessage 
( 
$str G
)G H
;H I
RuleFor 
( 
x 
=> 
x 
. 
	StartDate  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage 
( 
$str 7
)7 8
;8 9
RuleFor 
( 
x 
=> 
x 
. 
EndDate 
) 
. 
Must 
( 
( 
dto 
, 
endDate 
)  
=>! #
!$ %
endDate% ,
., -
HasValue- 5
||6 8
endDate9 @
.@ A
ValueA F
>=G I
dtoJ M
.M N
	StartDateN W
)W X
. 
When 
( 
x 
=> 
x 
. 
EndDate  
.  !
HasValue! )
)) *
. 
WithMessage 
( 
$str [
)[ \
;\ ]
RuleFor 
( 
x 
=> 
x 
. 
MaxParticipants &
)& '
. 
GreaterThan 
( 
$num 
) 
. 
When 
( 
x 
=> 
x 
. 
MaxParticipants (
.( )
HasValue) 1
)1 2
. 
WithMessage 
( 
$str T
)T U
;U V
RuleFor 
( 
x 
=> 
x 
. 
SurveyJsData #
)# $
.   
Must   
(   
BeValidJson   
)   
.!! 
When!! 
(!! 
x!! 
=>!! 
!!! 
string!! 
.!! 
IsNullOrEmpty!! ,
(!!, -
x!!- .
.!!. /
SurveyJsData!!/ ;
)!!; <
)!!< =
."" 
WithMessage"" 
("" 
$str"" W
)""W X
.## 
MaximumLength## 
(## 
$num##  
)##  !
.$$ 
When$$ 
($$ 
x$$ 
=>$$ 
!$$ 
string$$ 
.$$ 
IsNullOrEmpty$$ ,
($$, -
x$$- .
.$$. /
SurveyJsData$$/ ;
)$$; <
)$$< =
.%% 
WithMessage%% 
(%% 
$str%% ^
)%%^ _
;%%_ `
}&& 
private(( 
bool(( 
BeValidJson(( 
((( 
string(( #
?((# $
json((% )
)(() *
{)) 
if** 

(** 
string** 
.** 
IsNullOrWhiteSpace** %
(**% &
json**& *
)*** +
)**+ ,
return++ 
true++ 
;++ 
try-- 
{.. 	
using// 
var// 
doc// 
=// 
JsonDocument// (
.//( )
Parse//) .
(//. /
json/// 3
)//3 4
;//4 5
return00 
true00 
;00 
}11 	
catch22 
(22 
JsonException22 
)22 
{33 	
return44 
false44 
;44 
}55 	
}66 
}77 ÛÆ
1C:\Users\micha\Projects\ESN-WebApi\Web\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
	Configure 
<  
KestrelServerOptions /
>/ 0
(0 1
options1 8
=>9 ;
{ 
options 
. 
Limits 
. 
MaxRequestBodySize %
=& '
$num( *
*+ ,
$num- 1
*2 3
$num4 8
;8 9
}   
)   
;   
builder## 
.## 
Services## 
.## 
AddAuthorization## !
(##! "
)##" #
;### $
builder$$ 
.$$ 
Services$$ 
.$$ 
AddControllers$$ 
($$  
options$$  '
=>$$( *
{%% 
options&& 
.&& 
Filters&& 
.&& 
Add&& 
<&& &
RequestLoggingActionFilter&& 2
>&&2 3
(&&3 4
)&&4 5
;&&5 6
}'' 
)'' 
;'' 
builder** 
.** 
Services** 
.** -
!AddFluentValidationAutoValidation** 2
(**2 3
)**3 4
;**4 5
builder++ 
.++ 
Services++ 
.++ 1
%AddFluentValidationClientsideAdapters++ 6
(++6 7
)++7 8
;++8 9
builder,, 
.,, 
Services,, 
.,, /
#AddValidatorsFromAssemblyContaining,, 4
<,,4 5"
UserCreateDtoValidator,,5 K
>,,K L
(,,L M
),,M N
;,,N O
builder.. 
... 
Services.. 
... #
AddEndpointsApiExplorer.. (
(..( )
)..) *
;..* +
builder11 
.11 
Services11 
.11 
AddSwaggerGen11 
(11 
c11  
=>11! #
{22 
c33 
.33 

SwaggerDoc33 
(33 
$str33 
,33 
new33 
OpenApiInfo33 &
{33' (
Title33) .
=33/ 0
$str331 :
,33: ;
Version33< C
=33D E
$str33F J
}33K L
)33L M
;33M N
c55 
.55 !
AddSecurityDefinition55 
(55 
$str55 $
,55$ %
new55& )!
OpenApiSecurityScheme55* ?
{66 
In77 

=77 
ParameterLocation77 
.77 
Header77 %
,77% &
Description88 
=88 
$str88 U
,88U V
Name99 
=99 
$str99 
,99 
Type:: 
=:: 
SecuritySchemeType:: !
.::! "
ApiKey::" (
,::( )
Scheme;; 
=;; 
$str;; 
}<< 
)<< 
;<< 
c>> 
.>> "
AddSecurityRequirement>> 
(>> 
document>> %
=>>>& (
new>>) ,&
OpenApiSecurityRequirement>>- G
{?? 
[@@ 	
new@@	 *
OpenApiSecuritySchemeReference@@ +
(@@+ ,
$str@@, 4
,@@4 5
document@@6 >
)@@> ?
]@@? @
=@@A B
[@@C D
]@@D E
}AA 
)AA 
;AA 
}BB 
)BB 
;BB 
builderEE 
.EE 
ServicesEE 
.EE 
AddAutoMapperEE 
(EE 
cfgEE "
=>EE# %
{EE& '
cfgFF 
.FF 

AddProfileFF 
<FF 
MappingProfileFF !
>FF! "
(FF" #
)FF# $
;FF$ %
}GG 
)GG 
;GG 
builderJJ 
.JJ 
ServicesJJ 
.JJ 
AddDbContextJJ 
<JJ 
EsnDevContextJJ +
>JJ+ ,
(JJ, -
optionsJJ- 4
=>JJ5 7
optionsKK 
.KK 
UseSqlServerKK 
(KK 
builderKK  
.KK  !
ConfigurationKK! .
.KK. /
GetConnectionStringKK/ B
(KKB C
$strKKC V
)KKV W
,KKW X
bLL 	
=>LL
 
bLL 
.LL 
MigrationsAssemblyLL !
(LL! "
$strLL" '
)LL' (
)LL( )
)LL) *
;LL* +
builderOO 
.OO 
ServicesOO 
.OO 
	AddScopedOO 
<OO 
IUnitOfWorkOO &
,OO& '

UnitOfWorkOO( 2
>OO2 3
(OO3 4
)OO4 5
;OO5 6
builderRR 
.RR 
ServicesRR 
.RR 
AddHealthChecksRR  
(RR  !
)RR! "
.SS 
AddDbContextCheckSS 
<SS 
EsnDevContextSS $
>SS$ %
(SS% &
)SS& '
;SS' (
builderVV 
.VV 
ServicesVV 
.VV 
AddExceptionHandlerVV $
<VV$ %"
GlobalExceptionHandlerVV% ;
>VV; <
(VV< =
)VV= >
;VV> ?
builderWW 
.WW 
ServicesWW 
.WW 
AddProblemDetailsWW "
(WW" #
)WW# $
;WW$ %
builderZZ 
.ZZ 
ConfigurationZZ 
.ZZ 
AddJsonFileZZ !
(ZZ! "
$strZZ" 4
,ZZ4 5
optionalZZ6 >
:ZZ> ?
falseZZ@ E
,ZZE F
reloadOnChangeZZG U
:ZZU V
trueZZW [
)ZZ[ \
;ZZ\ ]
if]] 
(]] 
builder]] 
.]] 
Environment]] 
.]] 
IsDevelopment]] %
(]]% &
)]]& '
)]]' (
{^^ 
builder__ 
.__ 
Configuration__ 
.__ 
AddUserSecrets__ (
<__( )
Program__) 0
>__0 1
(__1 2
)__2 3
;__3 4
}`` 
varcc 
	jwtConfigcc 
=cc 
buildercc 
.cc 
Configurationcc %
.cc% &

GetSectioncc& 0
(cc0 1
$strcc1 6
)cc6 7
;cc7 8
vardd 
keydd 
=dd 	
Encodingdd
 
.dd 
UTF8dd 
.dd 
GetBytesdd  
(dd  !
	jwtConfigdd! *
[dd* +
$strdd+ 0
]dd0 1
??dd2 4
throwdd5 :
newdd; >%
InvalidOperationExceptiondd? X
(ddX Y
$strddY t
)ddt u
)ddu v
;ddv w
builderff 
.ff 
Servicesff 
.ff 
AddAuthenticationff "
(ff" #
optionsff# *
=>ff+ -
{gg 
optionshh 
.hh %
DefaultAuthenticateSchemehh %
=hh& '
JwtBearerDefaultshh( 9
.hh9 : 
AuthenticationSchemehh: N
;hhN O
optionsii 
.ii "
DefaultChallengeSchemeii "
=ii# $
JwtBearerDefaultsii% 6
.ii6 7 
AuthenticationSchemeii7 K
;iiK L
}jj 
)jj 
.kk 
AddJwtBearerkk 
(kk 
optionskk 
=>kk 
{ll 
optionsmm 
.mm %
TokenValidationParametersmm %
=mm& '
newmm( +%
TokenValidationParametersmm, E
{nn 
ValidateIssueroo 
=oo 
trueoo 
,oo 
ValidateAudiencepp 
=pp 
truepp 
,pp  
ValidateLifetimeqq 
=qq 
trueqq 
,qq  $
ValidateIssuerSigningKeyrr  
=rr! "
truerr# '
,rr' (
ValidIssuerss 
=ss 
	jwtConfigss 
[ss  
$strss  (
]ss( )
,ss) *
ValidAudiencett 
=tt 
	jwtConfigtt !
[tt! "
$strtt" ,
]tt, -
,tt- .
IssuerSigningKeyuu 
=uu 
newuu  
SymmetricSecurityKeyuu 3
(uu3 4
keyuu4 7
)uu7 8
,uu8 9
RoleClaimTypevv 
=vv 

ClaimTypesvv "
.vv" #
Rolevv# '
,vv' (
NameClaimTypeww 
=ww #
JwtRegisteredClaimNamesww /
.ww/ 0
Subww0 3
}xx 
;xx 
}yy 
)yy 
;yy 
builder{{ 
.{{ 
Services{{ 
.{{ 
	AddScoped{{ 
<{{ &
RequestLoggingActionFilter{{ 5
>{{5 6
({{6 7
){{7 8
;{{8 9
builder|| 
.|| 
Services|| 
.|| 
	AddScoped|| 
<|| 
Business|| #
.||# $

Interfaces||$ .
.||. /
IEventService||/ <
,||< =
EventService||> J
>||J K
(||K L
)||L M
;||M N
builder}} 
.}} 
Services}} 
.}} 
	AddScoped}} 
<}} 
Business}} #
.}}# $

Interfaces}}$ .
.}}. /!
IEventTemplateService}}/ D
,}}D E 
EventTemplateService}}F Z
>}}Z [
(}}[ \
)}}\ ]
;}}] ^
builder~~ 
.~~ 
Services~~ 
.~~ 
	AddScoped~~ 
<~~ 
Business~~ #
.~~# $

Interfaces~~$ .
.~~. /
ICalendarService~~/ ?
,~~? @
CalendarService~~A P
>~~P Q
(~~Q R
)~~R S
;~~S T
builder 
. 
Services 
. 
	AddScoped 
< 
Business #
.# $

Interfaces$ .
.. /
IPropositionService/ B
,B C
PropositionServiceD V
>V W
(W X
)X Y
;Y Z
builderÄÄ 
.
ÄÄ 
Services
ÄÄ 
.
ÄÄ 
	AddScoped
ÄÄ 
<
ÄÄ 
Business
ÄÄ #
.
ÄÄ# $

Interfaces
ÄÄ$ .
.
ÄÄ. /
IUserService
ÄÄ/ ;
,
ÄÄ; <
UserService
ÄÄ= H
>
ÄÄH I
(
ÄÄI J
)
ÄÄJ K
;
ÄÄK L
builderÅÅ 
.
ÅÅ 
Services
ÅÅ 
.
ÅÅ 
	AddScoped
ÅÅ 
<
ÅÅ 
Dal
ÅÅ 
.
ÅÅ 
Seeds
ÅÅ $
.
ÅÅ$ %
DatabaseSeeder
ÅÅ% 3
>
ÅÅ3 4
(
ÅÅ4 5
)
ÅÅ5 6
;
ÅÅ6 7
builderÑÑ 
.
ÑÑ 
Services
ÑÑ 
.
ÑÑ 
AddRateLimiter
ÑÑ 
(
ÑÑ  
options
ÑÑ  '
=>
ÑÑ( *
{ÖÖ 
options
ÜÜ 
.
ÜÜ !
RejectionStatusCode
ÜÜ 
=
ÜÜ  !
StatusCodes
ÜÜ" -
.
ÜÜ- .&
Status429TooManyRequests
ÜÜ. F
;
ÜÜF G
options
ââ 
.
ââ 
	AddPolicy
ââ 
(
ââ 
$str
ââ 
,
ââ 
context
ââ  '
=>
ââ( * 
RateLimitPartition
ää 
.
ää #
GetFixedWindowLimiter
ää 0
(
ää0 1
partitionKey
ãã 
:
ãã 
context
ãã !
.
ãã! "

Connection
ãã" ,
.
ãã, -
RemoteIpAddress
ãã- <
?
ãã< =
.
ãã= >
ToString
ãã> F
(
ããF G
)
ããG H
??
ããI K
$str
ããL U
,
ããU V
factory
åå 
:
åå 
_
åå 
=>
åå 
new
åå +
FixedWindowRateLimiterOptions
åå ;
{
çç 
PermitLimit
éé 
=
éé 
$num
éé !
,
éé! "
Window
èè 
=
èè 
TimeSpan
èè !
.
èè! "
FromMinutes
èè" -
(
èè- .
$num
èè. /
)
èè/ 0
,
èè0 1"
QueueProcessingOrder
êê $
=
êê% &"
QueueProcessingOrder
êê' ;
.
êê; <
OldestFirst
êê< G
,
êêG H

QueueLimit
ëë 
=
ëë 
$num
ëë 
}
íí 
)
íí 
)
íí 
;
íí 
options
ïï 
.
ïï 
	AddPolicy
ïï 
(
ïï 
$str
ïï 
,
ïï 
context
ïï &
=>
ïï' ) 
RateLimitPartition
ññ 
.
ññ #
GetFixedWindowLimiter
ññ 0
(
ññ0 1
partitionKey
óó 
:
óó 
context
óó !
.
óó! "

Connection
óó" ,
.
óó, -
RemoteIpAddress
óó- <
?
óó< =
.
óó= >
ToString
óó> F
(
óóF G
)
óóG H
??
óóI K
$str
óóL U
,
óóU V
factory
òò 
:
òò 
_
òò 
=>
òò 
new
òò +
FixedWindowRateLimiterOptions
òò ;
{
ôô 
PermitLimit
öö 
=
öö 
$num
öö 
,
öö  
Window
õõ 
=
õõ 
TimeSpan
õõ !
.
õõ! "
FromMinutes
õõ" -
(
õõ- .
$num
õõ. /
)
õõ/ 0
,
õõ0 1"
QueueProcessingOrder
úú $
=
úú% &"
QueueProcessingOrder
úú' ;
.
úú; <
OldestFirst
úú< G
,
úúG H

QueueLimit
ùù 
=
ùù 
$num
ùù 
}
ûû 
)
ûû 
)
ûû 
;
ûû 
options
°° 
.
°° 
	AddPolicy
°° 
(
°° 
$str
°° $
,
°°$ %
context
°°& -
=>
°°. 0 
RateLimitPartition
¢¢ 
.
¢¢ #
GetFixedWindowLimiter
¢¢ 0
(
¢¢0 1
partitionKey
££ 
:
££ 
context
££ !
.
££! "

Connection
££" ,
.
££, -
RemoteIpAddress
££- <
?
££< =
.
££= >
ToString
££> F
(
££F G
)
££G H
??
££I K
$str
££L U
,
££U V
factory
§§ 
:
§§ 
_
§§ 
=>
§§ 
new
§§ +
FixedWindowRateLimiterOptions
§§ ;
{
•• 
PermitLimit
¶¶ 
=
¶¶ 
$num
¶¶ 
,
¶¶  
Window
ßß 
=
ßß 
TimeSpan
ßß !
.
ßß! "
	FromHours
ßß" +
(
ßß+ ,
$num
ßß, -
)
ßß- .
,
ßß. /"
QueueProcessingOrder
®® $
=
®®% &"
QueueProcessingOrder
®®' ;
.
®®; <
OldestFirst
®®< G
,
®®G H

QueueLimit
©© 
=
©© 
$num
©© 
}
™™ 
)
™™ 
)
™™ 
;
™™ 
options
≠≠ 
.
≠≠ 
	AddPolicy
≠≠ 
(
≠≠ 
$str
≠≠ 
,
≠≠ 
context
≠≠  '
=>
≠≠( * 
RateLimitPartition
ÆÆ 
.
ÆÆ #
GetFixedWindowLimiter
ÆÆ 0
(
ÆÆ0 1
partitionKey
ØØ 
:
ØØ 
context
ØØ !
.
ØØ! "

Connection
ØØ" ,
.
ØØ, -
RemoteIpAddress
ØØ- <
?
ØØ< =
.
ØØ= >
ToString
ØØ> F
(
ØØF G
)
ØØG H
??
ØØI K
$str
ØØL U
,
ØØU V
factory
∞∞ 
:
∞∞ 
_
∞∞ 
=>
∞∞ 
new
∞∞ +
FixedWindowRateLimiterOptions
∞∞ ;
{
±± 
PermitLimit
≤≤ 
=
≤≤ 
$num
≤≤  
,
≤≤  !
Window
≥≥ 
=
≥≥ 
TimeSpan
≥≥ !
.
≥≥! "
FromMinutes
≥≥" -
(
≥≥- .
$num
≥≥. /
)
≥≥/ 0
,
≥≥0 1"
QueueProcessingOrder
¥¥ $
=
¥¥% &"
QueueProcessingOrder
¥¥' ;
.
¥¥; <
OldestFirst
¥¥< G
,
¥¥G H

QueueLimit
µµ 
=
µµ 
$num
µµ 
}
∂∂ 
)
∂∂ 
)
∂∂ 
;
∂∂ 
}∑∑ 
)
∑∑ 
;
∑∑ 
Log∫∫ 
.
∫∫ 
Logger
∫∫ 

=
∫∫ 
new
∫∫ !
LoggerConfiguration
∫∫ $
(
∫∫$ %
)
∫∫% &
.
ªª 
MinimumLevel
ªª 
.
ªª 
Debug
ªª 
(
ªª 
)
ªª 
.
ºº 
MinimumLevel
ºº 
.
ºº 
Override
ºº 
(
ºº 
$str
ºº &
,
ºº& '
LogEventLevel
ºº( 5
.
ºº5 6
Warning
ºº6 =
)
ºº= >
.
ΩΩ 
Enrich
ΩΩ 
.
ΩΩ 
FromLogContext
ΩΩ 
(
ΩΩ 
)
ΩΩ 
.
ææ 
Enrich
ææ 
.
ææ 
WithMachineName
ææ 
(
ææ 
)
ææ 
.
øø 
Enrich
øø 
.
øø 
WithThreadId
øø 
(
øø 
)
øø 
.
¿¿ 
Enrich
¿¿ 
.
¿¿ %
WithEnvironmentUserName
¿¿ #
(
¿¿# $
)
¿¿$ %
.
¡¡ 
WriteTo
¡¡ 
.
¡¡ 
Console
¡¡ 
(
¡¡ 
)
¡¡ 
.
¬¬ 
WriteTo
¬¬ 
.
¬¬ 
File
¬¬ 
(
¬¬ 
$str
¬¬ !
,
¬¬! "
rollingInterval
¬¬# 2
:
¬¬2 3
RollingInterval
¬¬4 C
.
¬¬C D
Day
¬¬D G
,
¬¬G H$
retainedFileCountLimit
¬¬I _
:
¬¬_ `
$num
¬¬a c
)
¬¬c d
.
√√ 
CreateLogger
√√ 
(
√√ 
)
√√ 
;
√√ 
var∆∆ 
allowedOrigins
∆∆ 
=
∆∆ 
builder
∆∆ 
.
∆∆ 
Configuration
∆∆ *
.
«« 

GetSection
«« 
(
«« 
$str
«« %
)
««% &
.
»» 
Get
»» 
<
»» 	
string
»»	 
[
»» 
]
»» 
>
»» 
(
»» 
)
»» 
??
»» 
Array
»» 
.
»» 
Empty
»» #
<
»»# $
string
»»$ *
>
»»* +
(
»»+ ,
)
»», -
;
»»- .
builder   
.
   
Services
   
.
   
AddCors
   
(
   
options
    
=>
  ! #
{ÀÀ 
options
ÃÃ 
.
ÃÃ 
	AddPolicy
ÃÃ 
(
ÃÃ 
$str
ÃÃ !
,
ÃÃ! "
policy
ÕÕ 
=>
ÕÕ 
{
ŒŒ 	
policy
œœ 
.
œœ 
WithOrigins
œœ 
(
œœ 
allowedOrigins
œœ -
)
œœ- .
.
–– 
AllowAnyHeader
–– !
(
––! "
)
––" #
.
—— 
AllowAnyMethod
—— !
(
——! "
)
——" #
.
““ 
AllowCredentials
““ #
(
““# $
)
““$ %
;
““% &
}
”” 	
)
””	 

;
””
 
}‘‘ 
)
‘‘ 
;
‘‘ 
builder÷÷ 
.
÷÷ 
Host
÷÷ 
.
÷÷ 

UseSerilog
÷÷ 
(
÷÷ 
)
÷÷ 
;
÷÷ 
varŸŸ 
app
ŸŸ 
=
ŸŸ 	
builder
ŸŸ
 
.
ŸŸ 
Build
ŸŸ 
(
ŸŸ 
)
ŸŸ 
;
ŸŸ 
using‹‹ 
(
‹‹ 
var
‹‹ 

scope
‹‹ 
=
‹‹ 
app
‹‹ 
.
‹‹ 
Services
‹‹ 
.
‹‹  
CreateScope
‹‹  +
(
‹‹+ ,
)
‹‹, -
)
‹‹- .
{›› 
var
ﬁﬁ 
seeder
ﬁﬁ 
=
ﬁﬁ 
scope
ﬁﬁ 
.
ﬁﬁ 
ServiceProvider
ﬁﬁ &
.
ﬁﬁ& ' 
GetRequiredService
ﬁﬁ' 9
<
ﬁﬁ9 :
Dal
ﬁﬁ: =
.
ﬁﬁ= >
Seeds
ﬁﬁ> C
.
ﬁﬁC D
DatabaseSeeder
ﬁﬁD R
>
ﬁﬁR S
(
ﬁﬁS T
)
ﬁﬁT U
;
ﬁﬁU V
await
ﬂﬂ 	
seeder
ﬂﬂ
 
.
ﬂﬂ 
	SeedAsync
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
}‡‡ 
app„„ 
.
„„ !
UseExceptionHandler
„„ 
(
„„ 
)
„„ 
;
„„ 
appÊÊ 
.
ÊÊ  
UseSecurityHeaders
ÊÊ 
(
ÊÊ 
)
ÊÊ 
;
ÊÊ 
ifËË 
(
ËË 
app
ËË 
.
ËË 
Environment
ËË 
.
ËË 
IsDevelopment
ËË !
(
ËË! "
)
ËË" #
)
ËË# $
{ÈÈ 
app
ÍÍ 
.
ÍÍ 

UseSwagger
ÍÍ 
(
ÍÍ 
)
ÍÍ 
;
ÍÍ 
app
ÎÎ 
.
ÎÎ 
UseSwaggerUI
ÎÎ 
(
ÎÎ 
)
ÎÎ 
;
ÎÎ 
}ÏÏ 
appÓÓ 
.
ÓÓ !
UseHttpsRedirection
ÓÓ 
(
ÓÓ 
)
ÓÓ 
;
ÓÓ 
appÔÔ 
.
ÔÔ 
UseCors
ÔÔ 
(
ÔÔ 
$str
ÔÔ 
)
ÔÔ 
;
ÔÔ 
app 
.
 
UseRateLimiter
 
(
 
)
 
;
 
appÒÒ 
.
ÒÒ 
UseAuthentication
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ 
appÚÚ 
.
ÚÚ 
UseMiddleware
ÚÚ 
<
ÚÚ &
RequestLoggingMiddleware
ÚÚ *
>
ÚÚ* +
(
ÚÚ+ ,
)
ÚÚ, -
;
ÚÚ- .
appÛÛ 
.
ÛÛ 
UseMiddleware
ÛÛ 
<
ÛÛ "
ValidateIdMiddleware
ÛÛ &
>
ÛÛ& '
(
ÛÛ' (
)
ÛÛ( )
;
ÛÛ) *
appÙÙ 
.
ÙÙ 
UseAuthorization
ÙÙ 
(
ÙÙ 
)
ÙÙ 
;
ÙÙ 
appıı 
.
ıı 
MapControllers
ıı 
(
ıı 
)
ıı 
;
ıı 
appˆˆ 
.
ˆˆ 
MapHealthChecks
ˆˆ 
(
ˆˆ 
$str
ˆˆ 
)
ˆˆ 
;
ˆˆ 
app¯¯ 
.
¯¯ 
Run
¯¯ 
(
¯¯ 
)
¯¯ 	
;
¯¯	 
µ/
JC:\Users\micha\Projects\ESN-WebApi\Web\Middlewares\ValidateIdMiddleware.cs
	namespace 	
Web
 
. 
Middlewares 
; 
public

 
class

  
ValidateIdMiddleware

 !
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
private 
readonly 
ILogger 
<  
ValidateIdMiddleware 1
>1 2
_logger3 :
;: ;
public 
 
ValidateIdMiddleware 
(  
RequestDelegate  /
next0 4
,4 5
ILogger6 =
<= > 
ValidateIdMiddleware> R
>R S
loggerT Z
)Z [
{ 
_next 
= 
next 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
context. 5
)5 6
{ 
if 

( 
context 
. 
Request 
. 
RouteValues '
.' (
TryGetValue( 3
(3 4
$str4 8
,8 9
out: =
var> A
idValueB I
)I J
)J K
{ 	
if 
( 
int 
. 
TryParse 
( 
idValue $
?$ %
.% &
ToString& .
(. /
)/ 0
,0 1
out2 5
var6 9
id: <
)< =
)= >
{ 
if 
( 
id 
<= 
$num 
) 
{ 
_logger 
. 

LogWarning &
(& '
$str' Q
,Q R
idS U
,U V
contextW ^
.^ _
Request_ f
.f g
Pathg k
)k l
;l m
context!! 
.!! 
Response!! $
.!!$ %

StatusCode!!% /
=!!0 1
StatusCodes!!2 =
.!!= >
Status400BadRequest!!> Q
;!!Q R
context"" 
."" 
Response"" $
.""$ %
ContentType""% 0
=""1 2
$str""3 E
;""E F
var$$ 
errorResponse$$ %
=$$& '
new$$( +
{%% 
error&& 
=&& 
$str&&  ,
,&&, -
message'' 
=''  !
$str''" X
,''X Y
id(( 
=(( 
id(( 
})) 
;)) 
await++ 
context++ !
.++! "
Response++" *
.++* +

WriteAsync+++ 5
(++5 6
JsonSerializer++6 D
.++D E
	Serialize++E N
(++N O
errorResponse++O \
)++\ ]
)++] ^
;++^ _
return,, 
;,, 
}-- 
}.. 
}// 	
foreach22 
(22 
var22 
routeKey22 
in22  
context22! (
.22( )
Request22) 0
.220 1
RouteValues221 <
.22< =
Keys22= A
)22A B
{33 	
if44 
(44 
routeKey44 
.44 
EndsWith44 !
(44! "
$str44" &
,44& '
StringComparison44( 8
.448 9
OrdinalIgnoreCase449 J
)44J K
&&44L N
routeKey44O W
!=44X Z
$str44[ _
)44_ `
{55 
if66 
(66 
context66 
.66 
Request66 #
.66# $
RouteValues66$ /
.66/ 0
TryGetValue660 ;
(66; <
routeKey66< D
,66D E
out66F I
var66J M
value66N S
)66S T
)66T U
{77 
if88 
(88 
int88 
.88 
TryParse88 $
(88$ %
value88% *
?88* +
.88+ ,
ToString88, 4
(884 5
)885 6
,886 7
out888 ;
var88< ?
paramId88@ G
)88G H
&&88I K
paramId88L S
<=88T V
$num88W X
)88X Y
{99 
_logger:: 
.::  

LogWarning::  *
(::* +
$str::+ b
,::b c
routeKey;; $
,;;$ %
paramId;;& -
,;;- .
context;;/ 6
.;;6 7
Request;;7 >
.;;> ?
Path;;? C
);;C D
;;;D E
context== 
.==  
Response==  (
.==( )

StatusCode==) 3
===4 5
StatusCodes==6 A
.==A B
Status400BadRequest==B U
;==U V
context>> 
.>>  
Response>>  (
.>>( )
ContentType>>) 4
=>>5 6
$str>>7 I
;>>I J
var@@ 
errorResponse@@ )
=@@* +
new@@, /
{AA 
errorBB !
=BB" #
$"BB$ &
$strBB& .
{BB. /
routeKeyBB/ 7
}BB7 8
"BB8 9
,BB9 :
messageCC #
=CC$ %
$"CC& (
$strCC( ,
{CC, -
routeKeyCC- 5
}CC5 6
$strCC6 d
"CCd e
,CCe f
valueDD !
=DD" #
paramIdDD$ +
}EE 
;EE 
awaitGG 
contextGG %
.GG% &
ResponseGG& .
.GG. /

WriteAsyncGG/ 9
(GG9 :
JsonSerializerGG: H
.GGH I
	SerializeGGI R
(GGR S
errorResponseGGS `
)GG` a
)GGa b
;GGb c
returnHH 
;HH 
}II 
}JJ 
}KK 
}LL 	
awaitNN 
_nextNN 
(NN 
contextNN 
)NN 
;NN 
}OO 
}PP ı
OC:\Users\micha\Projects\ESN-WebApi\Web\Middlewares\SecurityHeadersMiddleware.cs
	namespace 	
Web
 
. 
Middlewares 
; 
public 
class %
SecurityHeadersMiddleware &
(& '
RequestDelegate' 6
next7 ;
); <
{ 
public		 

async		 
Task		 
InvokeAsync		 !
(		! "
HttpContext		" -
context		. 5
)		5 6
{

 
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( @
,@ A
$strB K
)K L
;L M
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( 9
,9 :
$str; A
)A B
;B C
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( :
,: ;
$str< K
)K L
;L M
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( 9
,9 :
$str; \
)\ ]
;] ^
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( A
,A B
$strC o
)o p
;p q
context 
. 
Response 
. 
Headers  
.  !
Append! '
(' (
$str( <
,< =
$str> h
)h i
;i j
if"" 

("" 
!"" 
context"" 
."" 
Request"" 
."" 
IsHttps"" $
&&""% '
context""( /
.""/ 0
RequestServices""0 ?
.""? @
GetRequiredService""@ R
<""R S
IHostEnvironment""S c
>""c d
(""d e
)""e f
.""f g
IsProduction""g s
(""s t
)""t u
)""u v
{## 	
}&& 	
else'' 
if'' 
('' 
context'' 
.'' 
Request''  
.''  !
IsHttps''! (
)''( )
{(( 	
context)) 
.)) 
Response)) 
.)) 
Headers)) $
.))$ %
Append))% +
())+ ,
$str)), G
,))G H
$str))I n
)))n o
;))o p
}** 	
await,, 
next,, 
(,, 
context,, 
),, 
;,, 
}-- 
}.. 
public33 
static33 
class33 /
#SecurityHeadersMiddlewareExtensions33 7
{44 
public55 

static55 
IApplicationBuilder55 %
UseSecurityHeaders55& 8
(558 9
this559 =
IApplicationBuilder55> Q
builder55R Y
)55Y Z
{66 
return77 
builder77 
.77 
UseMiddleware77 $
<77$ %%
SecurityHeadersMiddleware77% >
>77> ?
(77? @
)77@ A
;77A B
}88 
}99 ¡
NC:\Users\micha\Projects\ESN-WebApi\Web\Middlewares\RequestLoggingMiddleware.cs
	namespace 	
Web
 
. 
Middlewares 
; 
public 
class $
RequestLoggingMiddleware %
(% &
RequestDelegate& 5
next6 :
): ;
{ 
public		 

async		 
Task		 
Invoke		 
(		 
HttpContext		 (
context		) 0
)		0 1
{

 
var 
	userEmail 
= 
context 
.  
User  $
?$ %
.% &
FindFirstValue& 4
(4 5#
JwtRegisteredClaimNames5 L
.L M
SubM P
)P Q
?? 
context 
.  
User  $
?$ %
.% &
FindFirstValue& 4
(4 5

ClaimTypes5 ?
.? @
NameIdentifier@ N
)N O
?? 
$str #
;# $
var 
path 
= 
context 
. 
Request "
." #
Path# '
;' (
var 
method 
= 
context 
. 
Request $
.$ %
Method% +
;+ ,
var 
ip 
= 
context 
. 

Connection #
.# $
RemoteIpAddress$ 3
?3 4
.4 5
ToString5 =
(= >
)> ?
;? @
Log 
. 
Information 
( 
$str Q
,Q R
method 
, 
path 
, 
	userEmail #
,# $
ip% '
,' (
DateTime) 1
.1 2
UtcNow2 8
)8 9
;9 :
await 
next 
( 
context 
) 
; 
Log 
. 
Information 
( 
$str O
,O P
method 
, 
path 
, 
context !
.! "
Response" *
.* +

StatusCode+ 5
)5 6
;6 7
} 
} §6
PC:\Users\micha\Projects\ESN-WebApi\Web\Middlewares\RequestLoggingActionFilter.cs
	namespace 	
Web
 
. 
Middlewares 
; 
public		 
class		 &
RequestLoggingActionFilter		 '
:		( )
IAsyncActionFilter		* <
{

 
private 
static 
readonly 
string "
[" #
]# $
SensitiveProperties% 8
=9 :
new; >
[> ?
]? @
{ 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
, 
$str 
} 
; 
public 

async 
Task "
OnActionExecutionAsync ,
(, -"
ActionExecutingContext- C
contextD K
,K L#
ActionExecutionDelegateM d
nexte i
)i j
{ 
var 

descriptor 
= 
context  
.  !
ActionDescriptor! 1
as2 4&
ControllerActionDescriptor5 O
;O P
var 
controllerName 
= 

descriptor '
?' (
.( )
ControllerName) 7
??8 :
$str; N
;N O
var 

actionName 
= 

descriptor #
?# $
.$ %

ActionName% /
??0 2
$str3 B
;B C
var 
	userEmail 
= 
context 
.  
HttpContext  +
.+ ,
User, 0
?0 1
.1 2
Identity2 :
?: ;
.; <
Name< @
??A C
$strD O
;O P
var   

parameters   
=   
context    
.    !
ActionArguments  ! 0
.  0 1
ToDictionary  1 =
(  = >
kvp!! 
=>!! 
kvp!! 
.!! 
Key!! 
,!! 
kvp"" 
=>"" 
kvp"" 
."" 
Value"" 
!="" 
null""  $
?""% & 
SanitizeAndSerialize""' ;
(""; <
kvp""< ?
.""? @
Value""@ E
)""E F
:""G H
$str""I O
)## 	
;##	 

Log%% 
.%% 
Information%% 
(%% 
$str%% a
,%%a b
controllerName&& 
,&& 

actionName&& &
,&&& '
	userEmail&&( 1
,&&1 2

parameters&&3 =
)&&= >
;&&> ?
await)) 
next)) 
()) 
))) 
;)) 
Log++ 
.++ 
Information++ 
(++ 
$str++ Y
,++Y Z
controllerName,, 
,,, 

actionName,, &
,,,& '
context,,( /
.,,/ 0
HttpContext,,0 ;
.,,; <
Response,,< D
?,,D E
.,,E F

StatusCode,,F P
),,P Q
;,,Q R
}-- 
private// 
static// 
string//  
SanitizeAndSerialize// .
(//. /
object/// 5
obj//6 9
)//9 :
{00 
var22 
	sanitized22 
=22 
RedactSensitiveData22 +
(22+ ,
obj22, /
)22/ 0
;220 1
return33 
JsonSerializer33 
.33 
	Serialize33 '
(33' (
	sanitized33( 1
,331 2
new333 6!
JsonSerializerOptions337 L
{33M N
WriteIndented33O \
=33] ^
true33_ c
}33d e
)33e f
;33f g
}44 
private66 
static66 
object66 
RedactSensitiveData66 -
(66- .
object66. 4
obj665 8
)668 9
{77 
if88 

(88 
obj88 
==88 
null88 
)88 
return88 
$str88  &
;88& '
var:: 
type:: 
=:: 
obj:: 
.:: 
GetType:: 
(:: 
)::  
;::  !
if== 

(== 
type== 
.== 
IsPrimitive== 
||== 
type==  $
====% '
typeof==( .
(==. /
string==/ 5
)==5 6
||==7 9
type==: >
====? A
typeof==B H
(==H I
DateTime==I Q
)==Q R
||==S U
type==V Z
====[ ]
typeof==^ d
(==d e
Guid==e i
)==i j
)==j k
return>> 
obj>> 
;>> 
varAA 
	sanitizedAA 
=AA 
newAA 

DictionaryAA &
<AA& '
stringAA' -
,AA- .
objectAA/ 5
>AA5 6
(AA6 7
)AA7 8
;AA8 9
varDD 

propertiesDD 
=DD 
typeDD 
.DD 
GetPropertiesDD +
(DD+ ,
BindingFlagsDD, 8
.DD8 9
PublicDD9 ?
|DD@ A
BindingFlagsDDB N
.DDN O
InstanceDDO W
)DDW X
;DDX Y
foreachFF 
(FF 
varFF 
propFF 
inFF 

propertiesFF '
)FF' (
{GG 	
varHH 
propNameHH 
=HH 
propHH 
.HH  
NameHH  $
;HH$ %
varII 
valueII 
=II 
propII 
.II 
GetValueII %
(II% &
objII& )
)II) *
;II* +
ifLL 
(LL 
SensitivePropertiesLL #
.LL# $
AnyLL$ '
(LL' (
sLL( )
=>LL* ,
propNameLL- 5
.LL5 6
EqualsLL6 <
(LL< =
sLL= >
,LL> ?
StringComparisonLL@ P
.LLP Q
OrdinalIgnoreCaseLLQ b
)LLb c
)LLc d
)LLd e
{MM 
	sanitizedNN 
[NN 
propNameNN "
]NN" #
=NN$ %
$strNN& 6
;NN6 7
}OO 
elsePP 
ifPP 
(PP 
valuePP 
!=PP 
nullPP "
)PP" #
{QQ 
	sanitizedRR 
[RR 
propNameRR "
]RR" #
=RR$ %
valueRR& +
;RR+ ,
}SS 
elseTT 
{UU 
	sanitizedVV 
[VV 
propNameVV "
]VV" #
=VV$ %
nullVV& *
!VV* +
;VV+ ,
}WW 
}XX 	
returnZZ 
	sanitizedZZ 
;ZZ 
}[[ 
}\\ ª,
LC:\Users\micha\Projects\ESN-WebApi\Web\Middlewares\GlobalExceptionHandler.cs
	namespace 	
Web
 
. 
Middlewares 
; 
public

 
class

 "
GlobalExceptionHandler

 #
(

# $
ILogger

$ +
<

+ ,"
GlobalExceptionHandler

, B
>

B C
logger

D J
,

J K
IHostEnvironment

L \
environment

] h
)

h i
:

j k
IExceptionHandler

l }
{ 
public 

async 
	ValueTask 
< 
bool 
>  
TryHandleAsync! /
(/ 0
HttpContext 
httpContext 
,  
	Exception 
	exception 
, 
CancellationToken 
cancellationToken +
)+ ,
{ 
logger 
. 
LogError 
( 
	exception !
,! "
$str# V
,V W
	exceptionX a
.a b
Messageb i
)i j
;j k
var 
errorResponse 
= 
	exception %
switch& ,
{ 	'
UnauthorizedAccessException '!
unauthorizedException( =
=>> @
newA D
ErrorResponseE R
{ 

StatusCode 
= 
( 
int !
)! "
HttpStatusCode" 0
.0 1
Unauthorized1 =
,= >
Message 
= 
$str .
,. /
Details 
= 
GetSafeDetails (
(( )!
unauthorizedException) >
)> ?
,? @
Path 
= 
httpContext "
." #
Request# *
.* +
Path+ /
} 
,  
KeyNotFoundException   
keyNotFoundException! 5
=>6 8
new9 <
ErrorResponse= J
{ 

StatusCode 
= 
( 
int !
)! "
HttpStatusCode" 0
.0 1
NotFound1 9
,9 :
Message 
= 
$str 1
,1 2
Details   
=   
GetSafeDetails   (
(  ( ) 
keyNotFoundException  ) =
)  = >
,  > ?
Path!! 
=!! 
httpContext!! "
.!!" #
Request!!# *
.!!* +
Path!!+ /
}"" 
,"" %
InvalidOperationException## %%
invalidOperationException##& ?
=>##@ B
new##C F
ErrorResponse##G T
{$$ 

StatusCode%% 
=%% 
(%% 
int%% !
)%%! "
HttpStatusCode%%" 0
.%%0 1

BadRequest%%1 ;
,%%; <
Message&& 
=&& 
$str&& .
,&&. /
Details'' 
='' 
GetSafeDetails'' (
(''( )%
invalidOperationException'') B
)''B C
,''C D
Path(( 
=(( 
httpContext(( "
.((" #
Request((# *
.((* +
Path((+ /
})) 
,)) 
ArgumentException** 
argumentException** /
=>**0 2
new**3 6
ErrorResponse**7 D
{++ 

StatusCode,, 
=,, 
(,, 
int,, !
),,! "
HttpStatusCode,," 0
.,,0 1

BadRequest,,1 ;
,,,; <
Message-- 
=-- 
$str-- -
,--- .
Details.. 
=.. 
GetSafeDetails.. (
(..( )
argumentException..) :
)..: ;
,..; <
Path// 
=// 
httpContext// "
.//" #
Request//# *
.//* +
Path//+ /
}00 
,00 
_11 
=>11 
new11 
ErrorResponse11 "
{22 

StatusCode33 
=33 
(33 
int33 !
)33! "
HttpStatusCode33" 0
.330 1
InternalServerError331 D
,33D E
Message44 
=44 
$str44 =
,44= >
Details55 
=55 
GetSafeDetails55 (
(55( )
	exception55) 2
)552 3
,553 4
Path66 
=66 
httpContext66 "
.66" #
Request66# *
.66* +
Path66+ /
}77 
}88 	
;88	 

httpContext:: 
.:: 
Response:: 
.:: 

StatusCode:: '
=::( )
errorResponse::* 7
.::7 8

StatusCode::8 B
;::B C
httpContext;; 
.;; 
Response;; 
.;; 
ContentType;; (
=;;) *
$str;;+ =
;;;= >
await== 
httpContext== 
.== 
Response== "
.==" #
WriteAsJsonAsync==# 3
(==3 4
errorResponse==4 A
,==A B
cancellationToken==C T
)==T U
;==U V
return?? 
true?? 
;?? 
}@@ 
privateFF 
stringFF 
GetSafeDetailsFF !
(FF! "
	ExceptionFF" +
	exceptionFF, 5
)FF5 6
{GG 
returnHH 
environmentHH 
.HH 
IsDevelopmentHH (
(HH( )
)HH) *
?II 
	exceptionII 
.II 
MessageII 
:JJ 
$strJJ p
;JJp q
}KK 
}LL é_
AC:\Users\micha\Projects\ESN-WebApi\Web\Mappings\MappingProfile.cs
	namespace

 	
Web


 
.

 
Mappings

 
{ 
public 

class 
MappingProfile 
:  !
Profile" )
{ 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
UserBo 
, 
UserDto %
>% &
(& '
)' (
.( )

ReverseMap) 3
(3 4
)4 5
;5 6
	CreateMap 
< 
UserCreateDto #
,# $
UserBo% +
>+ ,
(, -
)- .
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
PasswordHash( 4
,4 5
opt6 9
=>: <
opt= @
.@ A
IgnoreA G
(G H
)H I
)I J
;J K
	CreateMap 
< 
UserUpdateDto #
,# $
UserBo% +
>+ ,
(, -
)- .
.. /

ReverseMap/ 9
(9 :
): ;
;; <
	CreateMap 
< 
PropositionBo #
,# $
PropositionDto% 3
>3 4
(4 5
)5 6
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
User( ,
,, -
opt. 1
=>2 4
opt5 8
.8 9
MapFrom9 @
(@ A
srcA D
=>E G
srcH K
.K L
UserL P
)P Q
)Q R
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
EventBo 
, 
EventDto '
>' (
(( )
)) *
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (#
IsCurrentUserRegistered( ?
,? @
optA D
=>E G
optH K
.K L
IgnoreL R
(R S
)S T
)T U
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
CreateEventDto $
,$ %
EventBo& -
>- .
(. /
)/ 0
.   
	ForMember   
(   
dest   
=>    "
dest  # '
.  ' (
Id  ( *
,  * +
opt  , /
=>  0 2
opt  3 6
.  6 7
Ignore  7 =
(  = >
)  > ?
)  ? @
.!! 
	ForMember!! 
(!! 
dest!! 
=>!!  "
dest!!# '
.!!' (
UserId!!( .
,!!. /
opt!!0 3
=>!!4 6
opt!!7 :
.!!: ;
Ignore!!; A
(!!A B
)!!B C
)!!C D
."" 
	ForMember"" 
("" 
dest"" 
=>""  "
dest""# '
.""' (
	CreatedAt""( 1
,""1 2
opt""3 6
=>""7 9
opt"": =
.""= >
Ignore""> D
(""D E
)""E F
)""F G
.## 
	ForMember## 
(## 
dest## 
=>##  "
dest### '
.##' (
User##( ,
,##, -
opt##. 1
=>##2 4
opt##5 8
.##8 9
Ignore##9 ?
(##? @
)##@ A
)##A B
.$$ 
	ForMember$$ 
($$ 
dest$$ 
=>$$  "
dest$$# '
.$$' (
EventRegistrations$$( :
,$$: ;
opt$$< ?
=>$$@ B
opt$$C F
.$$F G
Ignore$$G M
($$M N
)$$N O
)$$O P
.%% 
	ForMember%% 
(%% 
dest%% 
=>%%  "
dest%%# '
.%%' (
	Calendars%%( 1
,%%1 2
opt%%3 6
=>%%7 9
opt%%: =
.%%= >
Ignore%%> D
(%%D E
)%%E F
)%%F G
;%%G H
	CreateMap(( 
<(( 
EventRegistrationBo(( )
,(() * 
EventRegistrationDto((+ ?
>((? @
(((@ A
)((A B
.)) 
	ForMember)) 
()) 
dest)) 
=>))  "
dest))# '
.))' (
User))( ,
,)), -
opt)). 1
=>))2 4
opt))5 8
.))8 9
MapFrom))9 @
())@ A
src))A D
=>))E G
src))H K
.))K L
User))L P
)))P Q
)))Q R
;))R S
	CreateMap,, 
<,, 
EventBo,, 
,,, %
EventWithRegistrationsDto,, 8
>,,8 9
(,,9 :
),,: ;
.-- 
	ForMember-- 
(-- 
dest-- 
=>--  "
dest--# '
.--' (
	Organizer--( 1
,--1 2
opt--3 6
=>--7 9
opt--: =
.--= >
MapFrom--> E
(--E F
src--F I
=>--J L
src--M P
.--P Q
User--Q U
)--U V
)--V W
... 
	ForMember.. 
(.. 
dest.. 
=>..  "
dest..# '
...' (
Registrations..( 5
,..5 6
opt..7 :
=>..; =
opt..> A
...A B
MapFrom..B I
(..I J
src..J M
=>..N P
src// 
.// 
EventRegistrations// *
.//* +
Where//+ 0
(//0 1
r//1 2
=>//3 5
r//6 7
.//7 8
Status//8 >
==//? A
RegistrationStatus//B T
.//T U

Registered//U _
)//_ `
)//` a
)//a b
.00 
	ForMember00 
(00 
dest00 
=>00  "
dest00# '
.00' (
TotalRegistered00( 7
,007 8
opt009 <
=>00= ?
opt00@ C
.00C D
MapFrom00D K
(00K L
src00L O
=>00P R
src11 
.11 
EventRegistrations11 *
.11* +
Count11+ 0
(110 1
r111 2
=>113 5
r116 7
.117 8
Status118 >
==11? A
RegistrationStatus11B T
.11T U

Registered11U _
)11_ `
)11` a
)11a b
;11b c
	CreateMap44 
<44 

CalendarBo44  
,44  !
CalendarDto44" -
>44- .
(44. /
)44/ 0
.55 
	ForMember55 
(55 
dest55 
=>55  "
dest55# '
.55' (
SubOrganizers55( 5
,555 6
opt557 :
=>55; =
opt55> A
.55A B
MapFrom55B I
(55I J
src55J M
=>55N P
src66 
.66 !
CalendarSubOrganizers66 -
.66- .
Select66. 4
(664 5
cso665 8
=>669 ;
cso66< ?
.66? @
User66@ D
)66D E
)66E F
)66F G
;66G H
	CreateMap88 
<88 
CalendarCreateDto88 '
,88' (

CalendarBo88) 3
>883 4
(884 5
)885 6
.99 
	ForMember99 
(99 
dest99 
=>99  "
dest99# '
.99' (
Id99( *
,99* +
opt99, /
=>990 2
opt993 6
.996 7
Ignore997 =
(99= >
)99> ?
)99? @
.:: 
	ForMember:: 
(:: 
dest:: 
=>::  "
dest::# '
.::' (
Event::( -
,::- .
opt::/ 2
=>::3 5
opt::6 9
.::9 :
Ignore::: @
(::@ A
)::A B
)::B C
.;; 
	ForMember;; 
(;; 
dest;; 
=>;;  "
dest;;# '
.;;' (
MainOrganizer;;( 5
,;;5 6
opt;;7 :
=>;;; =
opt;;> A
.;;A B
Ignore;;B H
(;;H I
);;I J
);;J K
.<< 
	ForMember<< 
(<< 
dest<< 
=><<  "
dest<<# '
.<<' (
EventManager<<( 4
,<<4 5
opt<<6 9
=><<: <
opt<<= @
.<<@ A
Ignore<<A G
(<<G H
)<<H I
)<<I J
.== 
	ForMember== 
(== 
dest== 
=>==  "
dest==# '
.==' (
ResponsableCom==( 6
,==6 7
opt==8 ;
=>==< >
opt==? B
.==B C
Ignore==C I
(==I J
)==J K
)==K L
.>> 
	ForMember>> 
(>> 
dest>> 
=>>>  "
dest>># '
.>>' (!
CalendarSubOrganizers>>( =
,>>= >
opt>>? B
=>>>C E
opt>>F I
.>>I J
Ignore>>J P
(>>P Q
)>>Q R
)>>R S
;>>S T
	CreateMap@@ 
<@@ 
CalendarUpdateDto@@ '
,@@' (

CalendarBo@@) 3
>@@3 4
(@@4 5
)@@5 6
.AA 
	ForMemberAA 
(AA 
destAA 
=>AA  "
destAA# '
.AA' (
IdAA( *
,AA* +
optAA, /
=>AA0 2
optAA3 6
.AA6 7
IgnoreAA7 =
(AA= >
)AA> ?
)AA? @
.BB 
	ForMemberBB 
(BB 
destBB 
=>BB  "
destBB# '
.BB' (
EventBB( -
,BB- .
optBB/ 2
=>BB3 5
optBB6 9
.BB9 :
IgnoreBB: @
(BB@ A
)BBA B
)BBB C
.CC 
	ForMemberCC 
(CC 
destCC 
=>CC  "
destCC# '
.CC' (
MainOrganizerCC( 5
,CC5 6
optCC7 :
=>CC; =
optCC> A
.CCA B
IgnoreCCB H
(CCH I
)CCI J
)CCJ K
.DD 
	ForMemberDD 
(DD 
destDD 
=>DD  "
destDD# '
.DD' (
EventManagerDD( 4
,DD4 5
optDD6 9
=>DD: <
optDD= @
.DD@ A
IgnoreDDA G
(DDG H
)DDH I
)DDI J
.EE 
	ForMemberEE 
(EE 
destEE 
=>EE  "
destEE# '
.EE' (
ResponsableComEE( 6
,EE6 7
optEE8 ;
=>EE< >
optEE? B
.EEB C
IgnoreEEC I
(EEI J
)EEJ K
)EEK L
.FF 
	ForMemberFF 
(FF 
destFF 
=>FF  "
destFF# '
.FF' (!
CalendarSubOrganizersFF( =
,FF= >
optFF? B
=>FFC E
optFFF I
.FFI J
IgnoreFFJ P
(FFP Q
)FFQ R
)FFR S
;FFS T
	CreateMapII 
<II 
EventTemplateBoII %
,II% &
EventTemplateDtoII' 7
>II7 8
(II8 9
)II9 :
.II: ;

ReverseMapII; E
(IIE F
)IIF G
;IIG H
	CreateMapKK 
<KK "
CreateEventTemplateDtoKK ,
,KK, -
EventTemplateBoKK. =
>KK= >
(KK> ?
)KK? @
.LL 
	ForMemberLL 
(LL 
destLL 
=>LL  "
destLL# '
.LL' (
IdLL( *
,LL* +
optLL, /
=>LL0 2
optLL3 6
.LL6 7
IgnoreLL7 =
(LL= >
)LL> ?
)LL? @
.MM 
	ForMemberMM 
(MM 
destMM 
=>MM  "
destMM# '
.MM' (
	CreatedAtMM( 1
,MM1 2
optMM3 6
=>MM7 9
optMM: =
.MM= >
IgnoreMM> D
(MMD E
)MME F
)MMF G
;MMG H
}NN 	
}OO 
}PP Õ
NC:\Users\micha\Projects\ESN-WebApi\Web\Extensions\ClaimsPrincipalExtensions.cs
	namespace 	
Web
 
. 

Extensions 
; 
public		 
static		 
class		 %
ClaimsPrincipalExtensions		 -
{

 
public 

static 
string 
? 
GetUserEmail &
(& '
this' +
ClaimsPrincipal, ;
user< @
)@ A
{ 
return 
user 
. 
FindFirstValue "
(" #

ClaimTypes# -
.- .
NameIdentifier. <
)< =
?? 
user 
. 
FindFirstValue "
(" ##
JwtRegisteredClaimNames# :
.: ;
Sub; >
)> ?
;? @
} 
public 

static 
string 
GetUserEmailOrThrow ,
(, -
this- 1
ClaimsPrincipal2 A
userB F
)F G
{ 
var 
email 
= 
user 
. 
GetUserEmail %
(% &
)& '
;' (
if 

( 
string 
. 
IsNullOrEmpty  
(  !
email! &
)& '
)' (
throw   
new   '
UnauthorizedAccessException   1
(  1 2
$str  2 R
)  R S
;  S T
return!! 
email!! 
;!! 
}"" 
}## ›ú
EC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\UsersController.cs
	namespace 	
Web
 
. 
Controllers 
; 
[ 
Route 
( 
$str 
) 
] 
[ 
ApiController 
] 
[ 
ServiceFilter 
( 
typeof 
( &
RequestLoggingActionFilter 0
)0 1
)1 2
]2 3
public 
class 
UsersController 
( 
Business %
.% &

Interfaces& 0
.0 1
IUserService1 =
userService> I
,I J
ILoggerK R
<R S
UsersControllerS b
>b c
loggerd j
)j k
:l m
ControllerBasen |
{ 
[ 
HttpPost 
( 
$str 
) 
] 
[ 
EnableRateLimiting 
( 
$str 
)  
]  !
[  
ProducesResponseType 
( 
typeof  
(  ! 
UserLoginResponseDto! 5
)5 6
,6 7
StatusCodes8 C
.C D
Status200OKD O
)O P
]P Q
[  
ProducesResponseType 
( 
StatusCodes %
.% &
Status400BadRequest& 9
)9 :
]: ;
[  
ProducesResponseType 
( 
StatusCodes %
.% &!
Status401Unauthorized& ;
); <
]< =
[  
ProducesResponseType 
( 
StatusCodes %
.% &
Status403Forbidden& 8
)8 9
]9 :
public 

async 
Task 
< 
ActionResult "
<" #
string# )
>) *
>* +
Login, 1
(1 2
UserLoginDto2 >
loginDto? G
)G H
{ 
logger 
. 
LogInformation 
( 
$str B
,B C
loginDtoD L
.L M
EmailM R
)R S
;S T
try 
{ 	
var 
response 
= 
await  
userService! ,
., -

LoginAsync- 7
(7 8
loginDto8 @
)@ A
;A B
logger   
.   
LogInformation   !
(  ! "
$str  " @
,  @ A
loginDto  B J
.  J K
Email  K P
)  P Q
;  Q R
return"" 
Ok"" 
("" 
response"" 
)"" 
;""  
}## 	
catch$$ 
($$ $
ForbiddenAccessException$$ '
ex$$( *
)$$* +
{%% 	
logger&& 
.&& 

LogWarning&& 
(&& 
ex&&  
,&&  !
$str&&" @
)&&@ A
;&&A B
return'' 

StatusCode'' 
('' 
StatusCodes'' )
.'') *
Status403Forbidden''* <
,''< =
new''> A
{''B C
message''D K
=''L M
ex''N P
.''P Q
Message''Q X
}''Y Z
)''Z [
;''[ \
}(( 	
catch)) 
()) '
UnauthorizedAccessException)) *
ex))+ -
)))- .
{** 	
logger++ 
.++ 

LogWarning++ 
(++ 
ex++  
,++  !
$str++" ?
)++? @
;++@ A
return,, 
Unauthorized,, 
(,,  
new,,  #
{,,$ %
message,,& -
=,,. /
ex,,0 2
.,,2 3
Message,,3 :
},,; <
),,< =
;,,= >
}-- 	
}.. 
[00 
HttpPost00 
(00 
$str00 
)00 
]00 
[11  
ProducesResponseType11 
(11 
typeof11  
(11  ! 
UserLoginResponseDto11! 5
)115 6
,116 7
StatusCodes118 C
.11C D
Status200OK11D O
)11O P
]11P Q
[22  
ProducesResponseType22 
(22 
StatusCodes22 %
.22% &!
Status401Unauthorized22& ;
)22; <
]22< =
[33  
ProducesResponseType33 
(33 
StatusCodes33 %
.33% &
Status404NotFound33& 7
)337 8
]338 9
[44  
ProducesResponseType44 
(44 
StatusCodes44 %
.44% &(
Status500InternalServerError44& B
)44B C
]44C D
public55 

async55 
Task55 
<55 
ActionResult55 "
<55" # 
UserLoginResponseDto55# 7
>557 8
>558 9
RefreshToken55: F
(55F G
)55G H
{66 
logger77 
.77 
LogInformation77 
(77 
$str77 >
)77> ?
;77? @
try99 
{:: 	
var<< 

authHeader<< 
=<< 
Request<< $
.<<$ %
Headers<<% ,
.<<, -
Authorization<<- :
.<<: ;
ToString<<; C
(<<C D
)<<D E
;<<E F
if== 
(== 
string== 
.== 
IsNullOrEmpty== $
(==$ %

authHeader==% /
)==/ 0
||==1 3
!==4 5

authHeader==5 ?
.==? @

StartsWith==@ J
(==J K
$str==K T
)==T U
)==U V
{>> 
logger?? 
.?? 

LogWarning?? !
(??! "
$str??" Q
)??Q R
;??R S
return@@ 
Unauthorized@@ #
(@@# $
$str@@$ 7
)@@7 8
;@@8 9
}AA 
varCC 
tokenCC 
=CC 

authHeaderCC "
.CC" #
	SubstringCC# ,
(CC, -
$strCC- 6
.CC6 7
LengthCC7 =
)CC= >
.CC> ?
TrimCC? C
(CCC D
)CCD E
;CCE F
varEE 
responseEE 
=EE 
awaitEE  
userServiceEE! ,
.EE, -
RefreshTokenAsyncEE- >
(EE> ?
tokenEE? D
)EED E
;EEE F
loggerGG 
.GG 
LogInformationGG !
(GG! "
$strGG" <
)GG< =
;GG= >
returnII 
OkII 
(II 
responseII 
)II 
;II  
}JJ 	
catchKK 
(KK '
UnauthorizedAccessExceptionKK *
exKK+ -
)KK- .
{LL 	
loggerMM 
.MM 

LogWarningMM 
(MM 
exMM  
,MM  !
$strMM" @
)MM@ A
;MMA B
returnNN 
UnauthorizedNN 
(NN  
exNN  "
.NN" #
MessageNN# *
)NN* +
;NN+ ,
}OO 	
catchPP 
(PP  
KeyNotFoundExceptionPP #
exPP$ &
)PP& '
{QQ 	
loggerRR 
.RR 

LogWarningRR 
(RR 
exRR  
,RR  !
$strRR" B
)RRB C
;RRC D
returnSS 
NotFoundSS 
(SS 
exSS 
.SS 
MessageSS &
)SS& '
;SS' (
}TT 	
catchUU 
(UU 
	ExceptionUU 
exUU 
)UU 
{VV 	
loggerWW 
.WW 
LogErrorWW 
(WW 
exWW 
,WW 
$strWW  E
)WWE F
;WWF G
returnXX 

StatusCodeXX 
(XX 
$numXX !
,XX! "
$strXX# Q
)XXQ R
;XXR S
}YY 	
}ZZ 
[\\ 
	Authorize\\ 
]\\ 
[]] 
HttpGet]] 
(]] 
$str]] 
)]] 
]]] 
[^^  
ProducesResponseType^^ 
(^^ 
typeof^^  
(^^  !
UserDto^^! (
)^^( )
,^^) *
StatusCodes^^+ 6
.^^6 7
Status200OK^^7 B
)^^B C
]^^C D
[__  
ProducesResponseType__ 
(__ 
StatusCodes__ %
.__% &
Status404NotFound__& 7
)__7 8
]__8 9
[``  
ProducesResponseType`` 
(`` 
StatusCodes`` %
.``% &!
Status401Unauthorized``& ;
)``; <
]``< =
publicaa 

asyncaa 
Taskaa 
<aa 
ActionResultaa "
<aa" #
UserDtoaa# *
>aa* +
>aa+ ,
GetCurrentUseraa- ;
(aa; <
)aa< =
{bb 
loggercc 
.cc 
LogInformationcc 
(cc 
$strcc ?
)cc? @
;cc@ A
tryee 
{ff 	
vargg 
emailgg 
=gg 
Usergg 
.gg 
GetUserEmailOrThrowgg 0
(gg0 1
)gg1 2
;gg2 3
varhh 
userDtohh 
=hh 
awaithh 
userServicehh  +
.hh+ ,
GetCurrentUserAsynchh, ?
(hh? @
emailhh@ E
)hhE F
;hhF G
ifjj 
(jj 
userDtojj 
==jj 
nulljj 
)jj  
{kk 
loggerll 
.ll 
LogInformationll %
(ll% &
$strll& G
)llG H
;llH I
returnmm 
NotFoundmm 
(mm  
)mm  !
;mm! "
}nn 
loggerpp 
.pp 
LogInformationpp !
(pp! "
$strpp" I
,ppI J
emailppK P
)ppP Q
;ppQ R
returnrr 
Okrr 
(rr 
userDtorr 
)rr 
;rr 
}ss 	
catchtt 
(tt '
UnauthorizedAccessExceptiontt *
extt+ -
)tt- .
{uu 	
loggervv 
.vv 

LogWarningvv 
(vv 
exvv  
,vv  !
$strvv" X
)vvX Y
;vvY Z
returnww 
Unauthorizedww 
(ww  
exww  "
.ww" #
Messageww# *
)ww* +
;ww+ ,
}xx 	
}yy 
[{{ 
HttpGet{{ 
]{{ 
[|| 
	Authorize|| 
]|| 
[}}  
ProducesResponseType}} 
(}} 
typeof}}  
(}}  !
PagedResult}}! ,
<}}, -
UserDto}}- 4
>}}4 5
)}}5 6
,}}6 7
StatusCodes}}8 C
.}}C D
Status200OK}}D O
)}}O P
]}}P Q
public~~ 

async~~ 
Task~~ 
<~~ 
ActionResult~~ "
<~~" #
PagedResult~~# .
<~~. /
UserDto~~/ 6
>~~6 7
>~~7 8
>~~8 9
GetUsers~~: B
(~~B C
[~~C D
	FromQuery~~D M
]~~M N
PaginationParams~~O _

pagination~~` j
)~~j k
{ 
logger
ÄÄ 
.
ÄÄ 
LogInformation
ÄÄ 
(
ÄÄ 
$str
ÄÄ ^
,
ÄÄ^ _

pagination
ÅÅ 
.
ÅÅ 

PageNumber
ÅÅ !
,
ÅÅ! "

pagination
ÅÅ# -
.
ÅÅ- .
PageSize
ÅÅ. 6
)
ÅÅ6 7
;
ÅÅ7 8
var
ÉÉ 
users
ÉÉ 
=
ÉÉ 
await
ÉÉ 
userService
ÉÉ %
.
ÉÉ% &
GetAllUsersAsync
ÉÉ& 6
(
ÉÉ6 7

pagination
ÉÉ7 A
)
ÉÉA B
;
ÉÉB C
logger
ÖÖ 
.
ÖÖ 
LogInformation
ÖÖ 
(
ÖÖ 
$str
ÖÖ \
,
ÖÖ\ ]
users
ÜÜ 
.
ÜÜ 
Items
ÜÜ 
.
ÜÜ 
Count
ÜÜ 
,
ÜÜ 
users
ÜÜ $
.
ÜÜ$ %

TotalCount
ÜÜ% /
)
ÜÜ/ 0
;
ÜÜ0 1
return
àà 
Ok
àà 
(
àà 
users
àà 
)
àà 
;
àà 
}
ââ 
[
ãã 
	Authorize
ãã 
]
ãã 
[
åå 
HttpGet
åå 
(
åå 
$str
åå 
)
åå 
]
åå 
[
çç "
ProducesResponseType
çç 
(
çç 
typeof
çç  
(
çç  !
UserDto
çç! (
)
çç( )
,
çç) *
StatusCodes
çç+ 6
.
çç6 7
Status200OK
çç7 B
)
ççB C
]
ççC D
[
éé "
ProducesResponseType
éé 
(
éé 
StatusCodes
éé %
.
éé% &
Status404NotFound
éé& 7
)
éé7 8
]
éé8 9
public
èè 

async
èè 
Task
èè 
<
èè 
ActionResult
èè "
<
èè" #
UserDto
èè# *
>
èè* +
>
èè+ ,
GetUser
èè- 4
(
èè4 5
int
èè5 8
id
èè9 ;
)
èè; <
{
êê 
logger
ëë 
.
ëë 
LogInformation
ëë 
(
ëë 
$str
ëë A
,
ëëA B
id
ëëC E
)
ëëE F
;
ëëF G
var
ìì 
user
ìì 
=
ìì 
await
ìì 
userService
ìì $
.
ìì$ %
GetUserByIdAsync
ìì% 5
(
ìì5 6
id
ìì6 8
)
ìì8 9
;
ìì9 :
if
ïï 

(
ïï 
user
ïï 
==
ïï 
null
ïï 
)
ïï 
{
ññ 	
logger
óó 
.
óó 
LogInformation
óó !
(
óó! "
$str
óó" A
,
óóA B
id
óóC E
)
óóE F
;
óóF G
return
òò 
NotFound
òò 
(
òò 
)
òò 
;
òò 
}
ôô 	
logger
õõ 
.
õõ 
LogInformation
õõ 
(
õõ 
$str
õõ ;
,
õõ; <
id
õõ= ?
)
õõ? @
;
õõ@ A
return
ùù 
Ok
ùù 
(
ùù 
user
ùù 
)
ùù 
;
ùù 
}
ûû 
[
†† 
	Authorize
†† 
]
†† 
[
°° 
HttpGet
°° 
(
°° 
$str
°° 
)
°° 
]
°° 
[
¢¢ "
ProducesResponseType
¢¢ 
(
¢¢ 
typeof
¢¢  
(
¢¢  !
IEnumerable
¢¢! ,
<
¢¢, -
UserDto
¢¢- 4
>
¢¢4 5
)
¢¢5 6
,
¢¢6 7
StatusCodes
¢¢8 C
.
¢¢C D
Status200OK
¢¢D O
)
¢¢O P
]
¢¢P Q
public
££ 

async
££ 
Task
££ 
<
££ 
ActionResult
££ "
<
££" #
IEnumerable
££# .
<
££. /
UserDto
££/ 6
>
££6 7
>
££7 8
>
££8 9
GetEsnMembers
££: G
(
££G H
)
££H I
{
§§ 
logger
•• 
.
•• 
LogInformation
•• 
(
•• 
$str
•• >
)
••> ?
;
••? @
var
ßß 

esnMembers
ßß 
=
ßß 
await
ßß 
userService
ßß *
.
ßß* + 
GetEsnMembersAsync
ßß+ =
(
ßß= >
)
ßß> ?
;
ßß? @
logger
©© 
.
©© 
LogInformation
©© 
(
©© 
$str
©© 8
)
©©8 9
;
©©9 :
return
´´ 
Ok
´´ 
(
´´ 

esnMembers
´´ 
)
´´ 
;
´´ 
}
¨¨ 
[
ÆÆ 
HttpPost
ÆÆ 
]
ÆÆ 
[
ØØ  
EnableRateLimiting
ØØ 
(
ØØ 
$str
ØØ &
)
ØØ& '
]
ØØ' (
[
∞∞ "
ProducesResponseType
∞∞ 
(
∞∞ 
typeof
∞∞  
(
∞∞  !
UserDto
∞∞! (
)
∞∞( )
,
∞∞) *
StatusCodes
∞∞+ 6
.
∞∞6 7
Status201Created
∞∞7 G
)
∞∞G H
]
∞∞H I
[
±± "
ProducesResponseType
±± 
(
±± 
StatusCodes
±± %
.
±±% &!
Status400BadRequest
±±& 9
)
±±9 :
]
±±: ;
[
≤≤ "
ProducesResponseType
≤≤ 
(
≤≤ 
StatusCodes
≤≤ %
.
≤≤% &
Status409Conflict
≤≤& 7
)
≤≤7 8
]
≤≤8 9
public
≥≥ 

async
≥≥ 
Task
≥≥ 
<
≥≥ 
ActionResult
≥≥ "
<
≥≥" #
UserDto
≥≥# *
>
≥≥* +
>
≥≥+ ,
PostUser
≥≥- 5
(
≥≥5 6
UserCreateDto
≥≥6 C
	createDto
≥≥D M
)
≥≥M N
{
¥¥ 
logger
µµ 
.
µµ 
LogInformation
µµ 
(
µµ 
$str
µµ E
,
µµE F
	createDto
µµG P
.
µµP Q
Email
µµQ V
)
µµV W
;
µµW X
try
∑∑ 
{
∏∏ 	
var
ππ 
response
ππ 
=
ππ 
await
ππ  
userService
ππ! ,
.
ππ, -
CreateUserAsync
ππ- <
(
ππ< =
	createDto
ππ= F
)
ππF G
;
ππG H
logger
ªª 
.
ªª 
LogInformation
ªª !
(
ªª! "
$str
ªª" C
,
ªªC D
	createDto
ªªE N
.
ªªN O
Email
ªªO T
)
ªªT U
;
ªªU V
return
ΩΩ 
CreatedAtAction
ΩΩ "
(
ΩΩ" #
nameof
ΩΩ# )
(
ΩΩ) *
GetUser
ΩΩ* 1
)
ΩΩ1 2
,
ΩΩ2 3
new
ΩΩ4 7
{
ΩΩ8 9
id
ΩΩ: <
=
ΩΩ= >
response
ΩΩ? G
.
ΩΩG H
Id
ΩΩH J
}
ΩΩK L
,
ΩΩL M
response
ΩΩN V
)
ΩΩV W
;
ΩΩW X
}
ææ 	
catch
øø 
(
øø '
InvalidOperationException
øø (
ex
øø) +
)
øø+ ,
{
¿¿ 	
logger
¡¡ 
.
¡¡ 

LogWarning
¡¡ 
(
¡¡ 
ex
¡¡  
,
¡¡  !
$str
¡¡" G
,
¡¡G H
	createDto
¡¡I R
.
¡¡R S
Email
¡¡S X
)
¡¡X Y
;
¡¡Y Z
return
¬¬ 
Conflict
¬¬ 
(
¬¬ 
new
¬¬ 
{
¬¬  !
message
¬¬" )
=
¬¬* +
$str
¬¬, c
}
¬¬d e
)
¬¬e f
;
¬¬f g
}
√√ 	
}
ƒƒ 
[
∆∆ 
	Authorize
∆∆ 
]
∆∆ 
[
«« 
HttpPut
«« 
(
«« 
$str
«« 
)
«« 
]
«« 
[
»» "
ProducesResponseType
»» 
(
»» 
typeof
»»  
(
»»  !
UserDto
»»! (
)
»»( )
,
»») *
StatusCodes
»»+ 6
.
»»6 7
Status200OK
»»7 B
)
»»B C
]
»»C D
[
…… "
ProducesResponseType
…… 
(
…… 
StatusCodes
…… %
.
……% &!
Status400BadRequest
……& 9
)
……9 :
]
……: ;
[
   "
ProducesResponseType
   
(
   
StatusCodes
   %
.
  % &
Status404NotFound
  & 7
)
  7 8
]
  8 9
[
ÀÀ "
ProducesResponseType
ÀÀ 
(
ÀÀ 
StatusCodes
ÀÀ %
.
ÀÀ% &#
Status401Unauthorized
ÀÀ& ;
)
ÀÀ; <
]
ÀÀ< =
public
ÃÃ 

async
ÃÃ 
Task
ÃÃ 
<
ÃÃ 
ActionResult
ÃÃ "
<
ÃÃ" #
UserDto
ÃÃ# *
>
ÃÃ* +
>
ÃÃ+ ,
PutPasswordUser
ÃÃ- <
(
ÃÃ< =
int
ÃÃ= @
id
ÃÃA C
,
ÃÃC D#
UserPasswordChangeDto
ÃÃE Z
passwordDto
ÃÃ[ f
)
ÃÃf g
{
ÕÕ 
logger
ŒŒ 
.
ŒŒ 
LogInformation
ŒŒ 
(
ŒŒ 
$str
ŒŒ I
,
ŒŒI J
id
ŒŒK M
)
ŒŒM N
;
ŒŒN O
try
–– 
{
—— 	
var
““ 
userDto
““ 
=
““ 
await
““ 
userService
““  +
.
““+ ,!
UpdatePasswordAsync
““, ?
(
““? @
id
““@ B
,
““B C
passwordDto
““D O
)
““O P
;
““P Q
if
‘‘ 
(
‘‘ 
userDto
‘‘ 
==
‘‘ 
null
‘‘ 
)
‘‘  
{
’’ 
logger
÷÷ 
.
÷÷ 
LogInformation
÷÷ %
(
÷÷% &
$str
÷÷& M
,
÷÷M N
id
÷÷O Q
)
÷÷Q R
;
÷÷R S
return
◊◊ 
NotFound
◊◊ 
(
◊◊  
)
◊◊  !
;
◊◊! "
}
ÿÿ 
logger
⁄⁄ 
.
⁄⁄ 
LogInformation
⁄⁄ !
(
⁄⁄! "
$str
⁄⁄" G
,
⁄⁄G H
id
⁄⁄I K
)
⁄⁄K L
;
⁄⁄L M
return
‹‹ 
Ok
‹‹ 
(
‹‹ 
userDto
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 	
catch
ﬁﬁ 
(
ﬁﬁ )
UnauthorizedAccessException
ﬁﬁ *
ex
ﬁﬁ+ -
)
ﬁﬁ- .
{
ﬂﬂ 	
logger
‡‡ 
.
‡‡ 

LogWarning
‡‡ 
(
‡‡ 
ex
‡‡  
,
‡‡  !
$str
‡‡" U
,
‡‡U V
id
‡‡W Y
)
‡‡Y Z
;
‡‡Z [
return
·· 
Unauthorized
·· 
(
··  
ex
··  "
.
··" #
Message
··# *
)
··* +
;
··+ ,
}
‚‚ 	
}
„„ 
[
ÂÂ 
	Authorize
ÂÂ 
]
ÂÂ 
[
ÊÊ 
HttpPut
ÊÊ 
(
ÊÊ 
$str
ÊÊ 
)
ÊÊ 
]
ÊÊ 
[
ÁÁ "
ProducesResponseType
ÁÁ 
(
ÁÁ 
typeof
ÁÁ  
(
ÁÁ  !
UserDto
ÁÁ! (
)
ÁÁ( )
,
ÁÁ) *
StatusCodes
ÁÁ+ 6
.
ÁÁ6 7
Status200OK
ÁÁ7 B
)
ÁÁB C
]
ÁÁC D
[
ËË "
ProducesResponseType
ËË 
(
ËË 
StatusCodes
ËË %
.
ËË% &!
Status400BadRequest
ËË& 9
)
ËË9 :
]
ËË: ;
[
ÈÈ "
ProducesResponseType
ÈÈ 
(
ÈÈ 
StatusCodes
ÈÈ %
.
ÈÈ% &
Status404NotFound
ÈÈ& 7
)
ÈÈ7 8
]
ÈÈ8 9
[
ÍÍ "
ProducesResponseType
ÍÍ 
(
ÍÍ 
StatusCodes
ÍÍ %
.
ÍÍ% & 
Status403Forbidden
ÍÍ& 8
)
ÍÍ8 9
]
ÍÍ9 :
public
ÎÎ 

async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
ActionResult
ÎÎ "
<
ÎÎ" #
UserDto
ÎÎ# *
>
ÎÎ* +
>
ÎÎ+ ,
PutUser
ÎÎ- 4
(
ÎÎ4 5
int
ÎÎ5 8
id
ÎÎ9 ;
,
ÎÎ; <
UserUpdateDto
ÎÎ= J
userDto
ÎÎK R
)
ÎÎR S
{
ÏÏ 
logger
ÌÌ 
.
ÌÌ 
LogInformation
ÌÌ 
(
ÌÌ 
$str
ÌÌ N
,
ÌÌN O
id
ÌÌP R
,
ÌÌR S
userDto
ÌÌT [
.
ÌÌ[ \
Email
ÌÌ\ a
)
ÌÌa b
;
ÌÌb c
try
ÔÔ 
{
 	
var
ÚÚ 
currentUserEmail
ÚÚ  
=
ÚÚ! "
User
ÚÚ# '
.
ÚÚ' (!
GetUserEmailOrThrow
ÚÚ( ;
(
ÚÚ; <
)
ÚÚ< =
;
ÚÚ= >
var
ÛÛ 
currentUser
ÛÛ 
=
ÛÛ 
await
ÛÛ #
userService
ÛÛ$ /
.
ÛÛ/ 0!
GetCurrentUserAsync
ÛÛ0 C
(
ÛÛC D
currentUserEmail
ÛÛD T
)
ÛÛT U
;
ÛÛU V
if
ıı 
(
ıı 
currentUser
ıı 
!=
ıı 
null
ıı #
&&
ıı$ &
currentUser
ıı' 2
.
ıı2 3
Id
ıı3 5
!=
ıı6 8
id
ıı9 ;
&&
ıı< >
!
ıı? @
User
ıı@ D
.
ııD E
IsInRole
ııE M
(
ııM N
$str
ııN U
)
ııU V
)
ııV W
{
ˆˆ 
logger
˜˜ 
.
˜˜ 

LogWarning
˜˜ !
(
˜˜! "
$str
˜˜" }
,
˜˜} ~
currentUser
¯¯ 
.
¯¯  
Id
¯¯  "
,
¯¯" #
id
¯¯$ &
)
¯¯& '
;
¯¯' (
return
˘˘ 
Forbid
˘˘ 
(
˘˘ 
)
˘˘ 
;
˘˘  
}
˙˙ 
var
¸¸ 
responseDto
¸¸ 
=
¸¸ 
await
¸¸ #
userService
¸¸$ /
.
¸¸/ 0
UpdateUserAsync
¸¸0 ?
(
¸¸? @
id
¸¸@ B
,
¸¸B C
userDto
¸¸D K
)
¸¸K L
;
¸¸L M
if
˛˛ 
(
˛˛ 
responseDto
˛˛ 
==
˛˛ 
null
˛˛ #
)
˛˛# $
{
ˇˇ 
logger
ÄÄ 
.
ÄÄ 
LogInformation
ÄÄ %
(
ÄÄ% &
$str
ÄÄ& E
,
ÄÄE F
id
ÄÄG I
)
ÄÄI J
;
ÄÄJ K
return
ÅÅ 
NotFound
ÅÅ 
(
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
}
ÇÇ 
logger
ÑÑ 
.
ÑÑ 
LogInformation
ÑÑ !
(
ÑÑ! "
$str
ÑÑ" B
,
ÑÑB C
userDto
ÑÑD K
.
ÑÑK L
Email
ÑÑL Q
)
ÑÑQ R
;
ÑÑR S
return
ÜÜ 
Ok
ÜÜ 
(
ÜÜ 
responseDto
ÜÜ !
)
ÜÜ! "
;
ÜÜ" #
}
áá 	
catch
àà 
(
àà )
UnauthorizedAccessException
àà *
ex
àà+ -
)
àà- .
{
ââ 	
logger
ää 
.
ää 

LogWarning
ää 
(
ää 
ex
ää  
,
ää  !
$str
ää" Q
)
ääQ R
;
ääR S
return
ãã 
Unauthorized
ãã 
(
ãã  
ex
ãã  "
.
ãã" #
Message
ãã# *
)
ãã* +
;
ãã+ ,
}
åå 	
}
çç 
[
èè 
	Authorize
èè 
(
èè 
Roles
èè 
=
èè 
$str
èè 
)
èè 
]
èè  
[
êê 

HttpDelete
êê 
(
êê 
$str
êê 
)
êê 
]
êê 
[
ëë "
ProducesResponseType
ëë 
(
ëë 
StatusCodes
ëë %
.
ëë% & 
Status204NoContent
ëë& 8
)
ëë8 9
]
ëë9 :
[
íí "
ProducesResponseType
íí 
(
íí 
StatusCodes
íí %
.
íí% &
Status404NotFound
íí& 7
)
íí7 8
]
íí8 9
public
ìì 

async
ìì 
Task
ìì 
<
ìì 
IActionResult
ìì #
>
ìì# $

DeleteUser
ìì% /
(
ìì/ 0
int
ìì0 3
id
ìì4 6
)
ìì6 7
{
îî 
logger
ïï 
.
ïï 
LogInformation
ïï 
(
ïï 
$str
ïï D
,
ïïD E
id
ïïF H
)
ïïH I
;
ïïI J
var
óó 
user
óó 
=
óó 
await
óó 
userService
óó $
.
óó$ %
DeleteUserAsync
óó% 4
(
óó4 5
id
óó5 7
)
óó7 8
;
óó8 9
if
ôô 

(
ôô 
user
ôô 
==
ôô 
null
ôô 
)
ôô 
{
öö 	
logger
õõ 
.
õõ 
LogInformation
õõ !
(
õõ! "
$str
õõ" D
,
õõD E
id
õõF H
)
õõH I
;
õõI J
return
úú 
NotFound
úú 
(
úú 
)
úú 
;
úú 
}
ùù 	
logger
üü 
.
üü 
LogInformation
üü 
(
üü 
$str
üü >
,
üü> ?
id
üü@ B
)
üüB C
;
üüC D
return
°° 
	NoContent
°° 
(
°° 
)
°° 
;
°° 
}
¢¢ 
[
´´ 
	Authorize
´´ 
(
´´ 
Roles
´´ 
=
´´ 
$str
´´ 
)
´´ 
]
´´  
[
¨¨ 
HttpGet
¨¨ 
(
¨¨ 
$str
¨¨ 
)
¨¨ 
]
¨¨ 
[
≠≠ "
ProducesResponseType
≠≠ 
(
≠≠ 
typeof
≠≠  
(
≠≠  !
IEnumerable
≠≠! ,
<
≠≠, -
UserDto
≠≠- 4
>
≠≠4 5
)
≠≠5 6
,
≠≠6 7
StatusCodes
≠≠8 C
.
≠≠C D
Status200OK
≠≠D O
)
≠≠O P
]
≠≠P Q
[
ÆÆ "
ProducesResponseType
ÆÆ 
(
ÆÆ 
StatusCodes
ÆÆ %
.
ÆÆ% &#
Status401Unauthorized
ÆÆ& ;
)
ÆÆ; <
]
ÆÆ< =
[
ØØ "
ProducesResponseType
ØØ 
(
ØØ 
StatusCodes
ØØ %
.
ØØ% & 
Status403Forbidden
ØØ& 8
)
ØØ8 9
]
ØØ9 :
public
∞∞ 

async
∞∞ 
Task
∞∞ 
<
∞∞ 
ActionResult
∞∞ "
<
∞∞" #
IEnumerable
∞∞# .
<
∞∞. /
UserDto
∞∞/ 6
>
∞∞6 7
>
∞∞7 8
>
∞∞8 9
GetPendingUsers
∞∞: I
(
∞∞I J
)
∞∞J K
{
±± 
logger
≤≤ 
.
≤≤ 
LogInformation
≤≤ 
(
≤≤ 
$str
≤≤ 6
)
≤≤6 7
;
≤≤7 8
var
¥¥ 
users
¥¥ 
=
¥¥ 
await
¥¥ 
userService
¥¥ %
.
¥¥% &#
GetUsersByStatusAsync
¥¥& ;
(
¥¥; <

UserStatus
¥¥< F
.
¥¥F G
Pending
¥¥G N
)
¥¥N O
;
¥¥O P
logger
∂∂ 
.
∂∂ 
LogInformation
∂∂ 
(
∂∂ 
$str
∂∂ K
,
∂∂K L
users
∂∂M R
.
∂∂R S
Count
∂∂S X
(
∂∂X Y
)
∂∂Y Z
)
∂∂Z [
;
∂∂[ \
return
∏∏ 
Ok
∏∏ 
(
∏∏ 
users
∏∏ 
)
∏∏ 
;
∏∏ 
}
ππ 
[
√√ 
	Authorize
√√ 
(
√√ 
Roles
√√ 
=
√√ 
$str
√√ 
)
√√ 
]
√√  
[
ƒƒ 
HttpPut
ƒƒ 
(
ƒƒ 
$str
ƒƒ 
)
ƒƒ 
]
ƒƒ 
[
≈≈ "
ProducesResponseType
≈≈ 
(
≈≈ 
StatusCodes
≈≈ %
.
≈≈% & 
Status204NoContent
≈≈& 8
)
≈≈8 9
]
≈≈9 :
[
∆∆ "
ProducesResponseType
∆∆ 
(
∆∆ 
StatusCodes
∆∆ %
.
∆∆% &#
Status401Unauthorized
∆∆& ;
)
∆∆; <
]
∆∆< =
[
«« "
ProducesResponseType
«« 
(
«« 
StatusCodes
«« %
.
««% & 
Status403Forbidden
««& 8
)
««8 9
]
««9 :
[
»» "
ProducesResponseType
»» 
(
»» 
StatusCodes
»» %
.
»»% &
Status404NotFound
»»& 7
)
»»7 8
]
»»8 9
public
…… 

async
…… 
Task
…… 
<
…… 
IActionResult
…… #
>
……# $
ApproveUser
……% 0
(
……0 1
int
……1 4
id
……5 7
)
……7 8
{
   
logger
ÀÀ 
.
ÀÀ 
LogInformation
ÀÀ 
(
ÀÀ 
$str
ÀÀ F
,
ÀÀF G
id
ÀÀH J
)
ÀÀJ K
;
ÀÀK L
try
ÕÕ 
{
ŒŒ 	
await
œœ 
userService
œœ 
.
œœ 
ApproveUserAsync
œœ .
(
œœ. /
id
œœ/ 1
)
œœ1 2
;
œœ2 3
logger
—— 
.
—— 
LogInformation
—— !
(
——! "
$str
——" R
,
——R S
id
——T V
)
——V W
;
——W X
return
”” 
	NoContent
”” 
(
”” 
)
”” 
;
”” 
}
‘‘ 	
catch
’’ 
(
’’ "
KeyNotFoundException
’’ #
ex
’’$ &
)
’’& '
{
÷÷ 	
logger
◊◊ 
.
◊◊ 

LogWarning
◊◊ 
(
◊◊ 
ex
◊◊  
,
◊◊  !
$str
◊◊" I
,
◊◊I J
id
◊◊K M
)
◊◊M N
;
◊◊N O
return
ÿÿ 
NotFound
ÿÿ 
(
ÿÿ 
new
ÿÿ 
{
ÿÿ  !
message
ÿÿ" )
=
ÿÿ* +
$"
ÿÿ, .
$str
ÿÿ. 3
{
ÿÿ3 4
id
ÿÿ4 6
}
ÿÿ6 7
$str
ÿÿ7 A
"
ÿÿA B
}
ÿÿC D
)
ÿÿD E
;
ÿÿE F
}
ŸŸ 	
}
⁄⁄ 
[
ÊÊ 
	Authorize
ÊÊ 
(
ÊÊ 
Roles
ÊÊ 
=
ÊÊ 
$str
ÊÊ 
)
ÊÊ 
]
ÊÊ  
[
ÁÁ 
HttpPut
ÁÁ 
(
ÁÁ 
$str
ÁÁ 
)
ÁÁ 
]
ÁÁ 
[
ËË "
ProducesResponseType
ËË 
(
ËË 
StatusCodes
ËË %
.
ËË% & 
Status204NoContent
ËË& 8
)
ËË8 9
]
ËË9 :
[
ÈÈ "
ProducesResponseType
ÈÈ 
(
ÈÈ 
StatusCodes
ÈÈ %
.
ÈÈ% &!
Status400BadRequest
ÈÈ& 9
)
ÈÈ9 :
]
ÈÈ: ;
[
ÍÍ "
ProducesResponseType
ÍÍ 
(
ÍÍ 
StatusCodes
ÍÍ %
.
ÍÍ% &#
Status401Unauthorized
ÍÍ& ;
)
ÍÍ; <
]
ÍÍ< =
[
ÎÎ "
ProducesResponseType
ÎÎ 
(
ÎÎ 
StatusCodes
ÎÎ %
.
ÎÎ% & 
Status403Forbidden
ÎÎ& 8
)
ÎÎ8 9
]
ÎÎ9 :
[
ÏÏ "
ProducesResponseType
ÏÏ 
(
ÏÏ 
StatusCodes
ÏÏ %
.
ÏÏ% &
Status404NotFound
ÏÏ& 7
)
ÏÏ7 8
]
ÏÏ8 9
public
ÌÌ 

async
ÌÌ 
Task
ÌÌ 
<
ÌÌ 
IActionResult
ÌÌ #
>
ÌÌ# $

RejectUser
ÌÌ% /
(
ÌÌ/ 0
int
ÌÌ0 3
id
ÌÌ4 6
,
ÌÌ6 7
[
ÌÌ8 9
FromBody
ÌÌ9 A
]
ÌÌA B
RejectUserDto
ÌÌC P
dto
ÌÌQ T
)
ÌÌT U
{
ÓÓ 
logger
ÔÔ 
.
ÔÔ 
LogInformation
ÔÔ 
(
ÔÔ 
$str
ÔÔ [
,
ÔÔ[ \
id
 
,
 
dto
 
.
 
Reason
 
??
 
$str
 2
)
2 3
;
3 4
if
ÚÚ 

(
ÚÚ 
!
ÚÚ 

ModelState
ÚÚ 
.
ÚÚ 
IsValid
ÚÚ 
)
ÚÚ  
{
ÛÛ 	
logger
ÙÙ 
.
ÙÙ 

LogWarning
ÙÙ 
(
ÙÙ 
$str
ÙÙ @
)
ÙÙ@ A
;
ÙÙA B
return
ıı 

BadRequest
ıı 
(
ıı 

ModelState
ıı (
)
ıı( )
;
ıı) *
}
ˆˆ 	
try
¯¯ 
{
˘˘ 	
await
˙˙ 
userService
˙˙ 
.
˙˙ 
RejectUserAsync
˙˙ -
(
˙˙- .
id
˙˙. 0
,
˙˙0 1
dto
˙˙2 5
.
˙˙5 6
Reason
˙˙6 <
)
˙˙< =
;
˙˙= >
logger
¸¸ 
.
¸¸ 
LogInformation
¸¸ !
(
¸¸! "
$str
¸¸" Q
,
¸¸Q R
id
¸¸S U
)
¸¸U V
;
¸¸V W
return
˛˛ 
	NoContent
˛˛ 
(
˛˛ 
)
˛˛ 
;
˛˛ 
}
ˇˇ 	
catch
ÄÄ 
(
ÄÄ "
KeyNotFoundException
ÄÄ #
ex
ÄÄ$ &
)
ÄÄ& '
{
ÅÅ 	
logger
ÇÇ 
.
ÇÇ 

LogWarning
ÇÇ 
(
ÇÇ 
ex
ÇÇ  
,
ÇÇ  !
$str
ÇÇ" H
,
ÇÇH I
id
ÇÇJ L
)
ÇÇL M
;
ÇÇM N
return
ÉÉ 
NotFound
ÉÉ 
(
ÉÉ 
new
ÉÉ 
{
ÉÉ  !
message
ÉÉ" )
=
ÉÉ* +
$"
ÉÉ, .
$str
ÉÉ. 3
{
ÉÉ3 4
id
ÉÉ4 6
}
ÉÉ6 7
$str
ÉÉ7 A
"
ÉÉA B
}
ÉÉC D
)
ÉÉD E
;
ÉÉE F
}
ÑÑ 	
}
ÖÖ 
}ÜÜ ñ¢
LC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\PropositionsController.cs
	namespace		 	
Web		
 
.		 
Controllers		 
;		 
[ 
Route 
( 
$str 
) 
] 
[ 
ApiController 
] 
[ 
ServiceFilter 
( 
typeof 
( &
RequestLoggingActionFilter 0
)0 1
)1 2
]2 3
public 
class "
PropositionsController #
(# $
Business$ ,
., -

Interfaces- 7
.7 8
IPropositionService8 K
propositionServiceL ^
,^ _
ILogger` g
<g h"
PropositionsControllerh ~
>~ 
logger
Ä Ü
)
Ü á
:
à â
ControllerBase
ä ò
{ 
[ 
HttpGet 
] 
[  
ProducesResponseType 
( 
typeof  
(  !
PagedResult! ,
<, -
PropositionDto- ;
>; <
)< =
,= >
StatusCodes? J
.J K
Status200OKK V
)V W
]W X
public 

async 
Task 
< 
ActionResult "
<" #
PagedResult# .
<. /
PropositionDto/ =
>= >
>> ?
>? @
GetPropositionsA P
(P Q
[Q R
	FromQueryR [
][ \
PaginationParams] m

paginationn x
)x y
{ 
logger 
. 
LogInformation 
( 
$str e
,e f

pagination 
. 

PageNumber !
,! "

pagination# -
.- .
PageSize. 6
)6 7
;7 8
string 
? 
	userEmail 
= 
null  
;  !
if 

( 
User 
. 
Identity 
? 
. 
IsAuthenticated *
==+ -
true. 2
)2 3
{ 	
try 
{ 
	userEmail 
= 
User  
.  !
GetUserEmailOrThrow! 4
(4 5
)5 6
;6 7
} 
catch 
{   
}"" 
}## 	
var%% 
propositions%% 
=%% 
await%%  
propositionService%%! 3
.%%3 4#
GetAllPropositionsAsync%%4 K
(%%K L

pagination%%L V
,%%V W
	userEmail%%X a
)%%a b
;%%b c
logger'' 
.'' 
LogInformation'' 
('' 
$str'' j
,''j k
propositions(( 
.(( 
Items(( 
.(( 
Count(( $
,(($ %
propositions((& 2
.((2 3

TotalCount((3 =
)((= >
;((> ?
return** 
Ok** 
(** 
propositions** 
)** 
;**  
}++ 
[-- 
HttpGet-- 
(-- 
$str-- 
)-- 
]-- 
[..  
ProducesResponseType.. 
(.. 
typeof..  
(..  !
PropositionDto..! /
)../ 0
,..0 1
StatusCodes..2 =
...= >
Status200OK..> I
)..I J
]..J K
[//  
ProducesResponseType// 
(// 
StatusCodes// %
.//% &
Status404NotFound//& 7
)//7 8
]//8 9
public00 

async00 
Task00 
<00 
ActionResult00 "
<00" #
PropositionDto00# 1
>001 2
>002 3
GetProposition004 B
(00B C
int00C F
id00G I
)00I J
{11 
logger22 
.22 
LogInformation22 
(22 
$str22 H
,22H I
id22J L
)22L M
;22M N
string55 
?55 
	userEmail55 
=55 
null55  
;55  !
if66 

(66 
User66 
.66 
Identity66 
?66 
.66 
IsAuthenticated66 *
==66+ -
true66. 2
)662 3
{77 	
try88 
{99 
	userEmail:: 
=:: 
User::  
.::  !
GetUserEmailOrThrow::! 4
(::4 5
)::5 6
;::6 7
};; 
catch<< 
{== 
}?? 
}@@ 	
varBB 
propositionBB 
=BB 
awaitBB 
propositionServiceBB  2
.BB2 3#
GetPropositionByIdAsyncBB3 J
(BBJ K
idBBK M
,BBM N
	userEmailBBO X
)BBX Y
;BBY Z
ifDD 

(DD 
propositionDD 
==DD 
nullDD 
)DD  
{EE 	
loggerFF 
.FF 
LogInformationFF !
(FF! "
$strFF" O
,FFO P
idFFQ S
)FFS T
;FFT U
returnGG 
NotFoundGG 
(GG 
)GG 
;GG 
}HH 	
loggerJJ 
.JJ 
LogInformationJJ 
(JJ 
$strJJ B
,JJB C
idJJD F
)JJF G
;JJG H
returnLL 
OkLL 
(LL 
propositionLL 
)LL 
;LL 
}MM 
[OO 
	AuthorizeOO 
]OO 
[PP 
HttpPostPP 
]PP 
[QQ  
ProducesResponseTypeQQ 
(QQ 
typeofQQ  
(QQ  !
PropositionDtoQQ! /
)QQ/ 0
,QQ0 1
StatusCodesQQ2 =
.QQ= >
Status201CreatedQQ> N
)QQN O
]QQO P
[RR  
ProducesResponseTypeRR 
(RR 
StatusCodesRR %
.RR% &
Status400BadRequestRR& 9
)RR9 :
]RR: ;
[SS  
ProducesResponseTypeSS 
(SS 
StatusCodesSS %
.SS% &!
Status401UnauthorizedSS& ;
)SS; <
]SS< =
publicTT 

asyncTT 
TaskTT 
<TT 
ActionResultTT "
<TT" #
PropositionDtoTT# 1
>TT1 2
>TT2 3
PostPropositionTT4 C
(TTC D
PropositionDtoTTD R
propositionDtoTTS a
)TTa b
{UU 
loggerVV 
.VV 
LogInformationVV 
(VV 
$strVV S
,VVS T
propositionDtoVVU c
.VVc d
TitleVVd i
)VVi j
;VVj k
ifXX 

(XX 
!XX 

ModelStateXX 
.XX 
IsValidXX 
)XX  
{YY 	
returnZZ 

BadRequestZZ 
(ZZ 

ModelStateZZ (
)ZZ( )
;ZZ) *
}[[ 	
try]] 
{^^ 	
var__ 
email__ 
=__ 
User__ 
.__ 
GetUserEmailOrThrow__ 0
(__0 1
)__1 2
;__2 3
var`` 
responseDto`` 
=`` 
await`` #
propositionService``$ 6
.``6 7"
CreatePropositionAsync``7 M
(``M N
propositionDto``N \
,``\ ]
email``^ c
)``c d
;``d e
loggerbb 
.bb 
LogInformationbb !
(bb! "
$strbb" J
,bbJ K
responseDtobbL W
.bbW X
TitlebbX ]
)bb] ^
;bb^ _
returndd 
CreatedAtActiondd "
(dd" #
nameofdd# )
(dd) *
GetPropositiondd* 8
)dd8 9
,dd9 :
newdd; >
{dd? @
idddA C
=ddD E
responseDtoddF Q
.ddQ R
IdddR T
}ddU V
,ddV W
responseDtoddX c
)ddc d
;ddd e
}ee 	
catchff 
(ff '
UnauthorizedAccessExceptionff *
exff+ -
)ff- .
{gg 	
loggerhh 
.hh 

LogWarninghh 
(hh 
exhh  
,hh  !
$strhh" B
)hhB C
;hhC D
returnii 
Unauthorizedii 
(ii  
exii  "
.ii" #
Messageii# *
)ii* +
;ii+ ,
}jj 	
}kk 
[mm 
	Authorizemm 
]mm 
[nn 
HttpPutnn 
(nn 
$strnn 
)nn 
]nn 
[oo  
ProducesResponseTypeoo 
(oo 
typeofoo  
(oo  !
PropositionDtooo! /
)oo/ 0
,oo0 1
StatusCodesoo2 =
.oo= >
Status200OKoo> I
)ooI J
]ooJ K
[pp  
ProducesResponseTypepp 
(pp 
StatusCodespp %
.pp% &
Status404NotFoundpp& 7
)pp7 8
]pp8 9
[qq  
ProducesResponseTypeqq 
(qq 
StatusCodesqq %
.qq% &!
Status401Unauthorizedqq& ;
)qq; <
]qq< =
publicrr 

asyncrr 
Taskrr 
<rr 
ActionResultrr "
<rr" #
PropositionDtorr# 1
>rr1 2
>rr2 3
PutPropositionrr4 B
(rrB C
intrrC F
idrrG I
,rrI J
PropositionDtorrK Y
propositionDtorrZ h
)rrh i
{ss 
loggertt 
.tt 
LogInformationtt 
(tt 
$strtt [
,tt[ \
idtt] _
,tt_ `
propositionDtotta o
.tto p
Titlettp u
)ttu v
;ttv w
tryvv 
{ww 	
varxx 
emailxx 
=xx 
Userxx 
.xx 
GetUserEmailOrThrowxx 0
(xx0 1
)xx1 2
;xx2 3
varyy 
responseDtoyy 
=yy 
awaityy #
propositionServiceyy$ 6
.yy6 7"
UpdatePropositionAsyncyy7 M
(yyM N
idyyN P
,yyP Q
propositionDtoyyR `
,yy` a
emailyyb g
)yyg h
;yyh i
if{{ 
({{ 
responseDto{{ 
=={{ 
null{{ #
){{# $
{|| 
logger}} 
.}} 
LogInformation}} %
(}}% &
$str}}& S
,}}S T
id}}U W
)}}W X
;}}X Y
return~~ 
NotFound~~ 
(~~  
)~~  !
;~~! "
} 
logger
ÅÅ 
.
ÅÅ 
LogInformation
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" F
,
ÅÅF G
id
ÅÅH J
)
ÅÅJ K
;
ÅÅK L
return
ÉÉ 
Ok
ÉÉ 
(
ÉÉ 
responseDto
ÉÉ !
)
ÉÉ! "
;
ÉÉ" #
}
ÑÑ 	
catch
ÖÖ 
(
ÖÖ )
UnauthorizedAccessException
ÖÖ *
ex
ÖÖ+ -
)
ÖÖ- .
{
ÜÜ 	
logger
áá 
.
áá 

LogWarning
áá 
(
áá 
ex
áá  
,
áá  !
$str
áá" A
)
ááA B
;
ááB C
return
àà 
Unauthorized
àà 
(
àà  
ex
àà  "
.
àà" #
Message
àà# *
)
àà* +
;
àà+ ,
}
ââ 	
}
ää 
[
åå 
	Authorize
åå 
]
åå 
[
çç 

HttpDelete
çç 
(
çç 
$str
çç 
)
çç 
]
çç 
[
éé "
ProducesResponseType
éé 
(
éé 
StatusCodes
éé %
.
éé% & 
Status204NoContent
éé& 8
)
éé8 9
]
éé9 :
[
èè "
ProducesResponseType
èè 
(
èè 
StatusCodes
èè %
.
èè% &
Status404NotFound
èè& 7
)
èè7 8
]
èè8 9
[
êê "
ProducesResponseType
êê 
(
êê 
StatusCodes
êê %
.
êê% &#
Status401Unauthorized
êê& ;
)
êê; <
]
êê< =
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
IActionResult
ëë #
>
ëë# $
DeleteProposition
ëë% 6
(
ëë6 7
int
ëë7 :
id
ëë; =
)
ëë= >
{
íí 
logger
ìì 
.
ìì 
LogInformation
ìì 
(
ìì 
$str
ìì K
,
ììK L
id
ììM O
)
ììO P
;
ììP Q
try
ïï 
{
ññ 	
var
óó 
email
óó 
=
óó 
User
óó 
.
óó !
GetUserEmailOrThrow
óó 0
(
óó0 1
)
óó1 2
;
óó2 3
var
òò 
proposition
òò 
=
òò 
await
òò # 
propositionService
òò$ 6
.
òò6 7$
DeletePropositionAsync
òò7 M
(
òòM N
id
òòN P
,
òòP Q
email
òòR W
)
òòW X
;
òòX Y
if
öö 
(
öö 
proposition
öö 
==
öö 
null
öö #
)
öö# $
{
õõ 
logger
úú 
.
úú 
LogInformation
úú %
(
úú% &
$str
úú& V
,
úúV W
id
úúX Z
)
úúZ [
;
úú[ \
return
ùù 
NotFound
ùù 
(
ùù  
)
ùù  !
;
ùù! "
}
ûû 
logger
†† 
.
†† 
LogInformation
†† !
(
††! "
$str
††" I
,
††I J
id
††K M
)
††M N
;
††N O
return
¢¢ 
	NoContent
¢¢ 
(
¢¢ 
)
¢¢ 
;
¢¢ 
}
££ 	
catch
§§ 
(
§§ )
UnauthorizedAccessException
§§ *
ex
§§+ -
)
§§- .
{
•• 	
logger
¶¶ 
.
¶¶ 

LogWarning
¶¶ 
(
¶¶ 
ex
¶¶  
,
¶¶  !
$str
¶¶" D
)
¶¶D E
;
¶¶E F
return
ßß 
Unauthorized
ßß 
(
ßß  
ex
ßß  "
.
ßß" #
Message
ßß# *
)
ßß* +
;
ßß+ ,
}
®® 	
}
©© 
[
´´ 
	Authorize
´´ 
]
´´ 
[
¨¨ 
HttpPost
¨¨ 
(
¨¨ 
$str
¨¨ 
)
¨¨ 
]
¨¨ 
[
≠≠  
EnableRateLimiting
≠≠ 
(
≠≠ 
$str
≠≠  
)
≠≠  !
]
≠≠! "
[
ÆÆ "
ProducesResponseType
ÆÆ 
(
ÆÆ 
typeof
ÆÆ  
(
ÆÆ  !
PropositionDto
ÆÆ! /
)
ÆÆ/ 0
,
ÆÆ0 1
StatusCodes
ÆÆ2 =
.
ÆÆ= >
Status200OK
ÆÆ> I
)
ÆÆI J
]
ÆÆJ K
[
ØØ "
ProducesResponseType
ØØ 
(
ØØ 
StatusCodes
ØØ %
.
ØØ% &
Status404NotFound
ØØ& 7
)
ØØ7 8
]
ØØ8 9
[
∞∞ "
ProducesResponseType
∞∞ 
(
∞∞ 
StatusCodes
∞∞ %
.
∞∞% &#
Status401Unauthorized
∞∞& ;
)
∞∞; <
]
∞∞< =
public
±± 

async
±± 
Task
±± 
<
±± 
ActionResult
±± "
<
±±" #
PropositionDto
±±# 1
>
±±1 2
>
±±2 3
VoteUp
±±4 :
(
±±: ;
int
±±; >
id
±±? A
)
±±A B
{
≤≤ 
logger
≥≥ 
.
≥≥ 
LogInformation
≥≥ 
(
≥≥ 
$str
≥≥ L
,
≥≥L M
id
≥≥N P
)
≥≥P Q
;
≥≥Q R
try
µµ 
{
∂∂ 	
var
∑∑ 
email
∑∑ 
=
∑∑ 
User
∑∑ 
.
∑∑ !
GetUserEmailOrThrow
∑∑ 0
(
∑∑0 1
)
∑∑1 2
;
∑∑2 3
var
∏∏ 
proposition
∏∏ 
=
∏∏ 
await
∏∏ # 
propositionService
∏∏$ 6
.
∏∏6 7
VoteUpAsync
∏∏7 B
(
∏∏B C
id
∏∏C E
,
∏∏E F
email
∏∏G L
)
∏∏L M
;
∏∏M N
if
∫∫ 
(
∫∫ 
proposition
∫∫ 
==
∫∫ 
null
∫∫ #
)
∫∫# $
{
ªª 
logger
ºº 
.
ºº 
LogInformation
ºº %
(
ºº% &
$str
ºº& K
,
ººK L
id
ººM O
)
ººO P
;
ººP Q
return
ΩΩ 
NotFound
ΩΩ 
(
ΩΩ  
)
ΩΩ  !
;
ΩΩ! "
}
ææ 
logger
¿¿ 
.
¿¿ 
LogInformation
¿¿ !
(
¿¿! "
$str
¿¿" J
,
¿¿J K
id
¿¿L N
)
¿¿N O
;
¿¿O P
return
¬¬ 
Ok
¬¬ 
(
¬¬ 
proposition
¬¬ !
)
¬¬! "
;
¬¬" #
}
√√ 	
catch
ƒƒ 
(
ƒƒ )
UnauthorizedAccessException
ƒƒ *
ex
ƒƒ+ -
)
ƒƒ- .
{
≈≈ 	
logger
∆∆ 
.
∆∆ 

LogWarning
∆∆ 
(
∆∆ 
ex
∆∆  
,
∆∆  !
$str
∆∆" 9
)
∆∆9 :
;
∆∆: ;
return
«« 
Unauthorized
«« 
(
««  
ex
««  "
.
««" #
Message
««# *
)
««* +
;
««+ ,
}
»» 	
}
…… 
[
ÀÀ 
	Authorize
ÀÀ 
]
ÀÀ 
[
ÃÃ 
HttpPost
ÃÃ 
(
ÃÃ 
$str
ÃÃ 
)
ÃÃ 
]
ÃÃ  
[
ÕÕ  
EnableRateLimiting
ÕÕ 
(
ÕÕ 
$str
ÕÕ  
)
ÕÕ  !
]
ÕÕ! "
[
ŒŒ "
ProducesResponseType
ŒŒ 
(
ŒŒ 
typeof
ŒŒ  
(
ŒŒ  !
PropositionDto
ŒŒ! /
)
ŒŒ/ 0
,
ŒŒ0 1
StatusCodes
ŒŒ2 =
.
ŒŒ= >
Status200OK
ŒŒ> I
)
ŒŒI J
]
ŒŒJ K
[
œœ "
ProducesResponseType
œœ 
(
œœ 
StatusCodes
œœ %
.
œœ% &
Status404NotFound
œœ& 7
)
œœ7 8
]
œœ8 9
[
–– "
ProducesResponseType
–– 
(
–– 
StatusCodes
–– %
.
––% &#
Status401Unauthorized
––& ;
)
––; <
]
––< =
public
—— 

async
—— 
Task
—— 
<
—— 
ActionResult
—— "
<
——" #
PropositionDto
——# 1
>
——1 2
>
——2 3
VoteDown
——4 <
(
——< =
int
——= @
id
——A C
)
——C D
{
““ 
logger
”” 
.
”” 
LogInformation
”” 
(
”” 
$str
”” N
,
””N O
id
””P R
)
””R S
;
””S T
try
’’ 
{
÷÷ 	
var
◊◊ 
email
◊◊ 
=
◊◊ 
User
◊◊ 
.
◊◊ !
GetUserEmailOrThrow
◊◊ 0
(
◊◊0 1
)
◊◊1 2
;
◊◊2 3
var
ÿÿ 
proposition
ÿÿ 
=
ÿÿ 
await
ÿÿ # 
propositionService
ÿÿ$ 6
.
ÿÿ6 7
VoteDownAsync
ÿÿ7 D
(
ÿÿD E
id
ÿÿE G
,
ÿÿG H
email
ÿÿI N
)
ÿÿN O
;
ÿÿO P
if
⁄⁄ 
(
⁄⁄ 
proposition
⁄⁄ 
==
⁄⁄ 
null
⁄⁄ #
)
⁄⁄# $
{
€€ 
logger
‹‹ 
.
‹‹ 
LogInformation
‹‹ %
(
‹‹% &
$str
‹‹& M
,
‹‹M N
id
‹‹O Q
)
‹‹Q R
;
‹‹R S
return
›› 
NotFound
›› 
(
››  
)
››  !
;
››! "
}
ﬁﬁ 
logger
‡‡ 
.
‡‡ 
LogInformation
‡‡ !
(
‡‡! "
$str
‡‡" L
,
‡‡L M
id
‡‡N P
)
‡‡P Q
;
‡‡Q R
return
‚‚ 
Ok
‚‚ 
(
‚‚ 
proposition
‚‚ !
)
‚‚! "
;
‚‚" #
}
„„ 	
catch
‰‰ 
(
‰‰ )
UnauthorizedAccessException
‰‰ *
ex
‰‰+ -
)
‰‰- .
{
ÂÂ 	
logger
ÊÊ 
.
ÊÊ 

LogWarning
ÊÊ 
(
ÊÊ 
ex
ÊÊ  
,
ÊÊ  !
$str
ÊÊ" ;
)
ÊÊ; <
;
ÊÊ< =
return
ÁÁ 
Unauthorized
ÁÁ 
(
ÁÁ  
ex
ÁÁ  "
.
ÁÁ" #
Message
ÁÁ# *
)
ÁÁ* +
;
ÁÁ+ ,
}
ËË 	
}
ÈÈ 
}ÍÍ ¨:
PC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\PropositionAdminController.cs
	namespace

 	
Web


 
.

 
Controllers

 
;

 
[ 
Route 
( 
$str 
)  
]  !
[ 
ApiController 
] 
[ 
	Authorize 

]
 
[ 
ServiceFilter 
( 
typeof 
( &
RequestLoggingActionFilter 0
)0 1
)1 2
]2 3
public 
class &
PropositionAdminController '
(' (
IPropositionService 
propositionService *
,* +
ILogger 
< &
PropositionAdminController &
>& '
logger( .
). /
:0 1
ControllerBase2 @
{ 
[## 
HttpGet## 
]## 
[$$  
ProducesResponseType$$ 
($$ 
typeof$$  
($$  !
PagedResult$$! ,
<$$, -
PropositionDto$$- ;
>$$; <
)$$< =
,$$= >
StatusCodes$$? J
.$$J K
Status200OK$$K V
)$$V W
]$$W X
[%%  
ProducesResponseType%% 
(%% 
StatusCodes%% %
.%%% &!
Status401Unauthorized%%& ;
)%%; <
]%%< =
[&&  
ProducesResponseType&& 
(&& 
StatusCodes&& %
.&&% &
Status403Forbidden&&& 8
)&&8 9
]&&9 :
public'' 

async'' 
Task'' 
<'' 
ActionResult'' "
<''" #
PagedResult''# .
<''. /
PropositionDto''/ =
>''= >
>''> ?
>''? @
GetAllPropositions''A S
(''S T
[(( 	
	FromQuery((	 
](( 
PaginationParams(( $

pagination((% /
,((/ 0
[)) 	
	FromQuery))	 
]))  
PropositionFilterDto)) (
filter))) /
)))/ 0
{** 
logger++ 
.++ 
LogInformation++ 
(++ 
$str,, o
,,,o p

pagination-- 
.-- 

PageNumber-- !
,--! "

pagination--# -
.--- .
PageSize--. 6
,--6 7
filter--8 >
.--> ?
Status--? E
)--E F
;--F G
try// 
{00 	
var11 
email11 
=11 
User11 
.11 
GetUserEmailOrThrow11 0
(110 1
)111 2
;112 3
var22 
propositions22 
=22 
await22 $
propositionService22% 7
.227 8+
GetAllPropositionsForAdminAsync228 W
(22W X

pagination22X b
,22b c
filter22d j
,22j k
email22l q
)22q r
;22r s
logger44 
.44 
LogInformation44 !
(44! "
$str44" y
,44y z
propositions55 
.55 
Items55 "
.55" #
Count55# (
,55( )
propositions55* 6
.556 7

TotalCount557 A
)55A B
;55B C
return77 
Ok77 
(77 
propositions77 "
)77" #
;77# $
}88 	
catch99 
(99 '
UnauthorizedAccessException99 *
ex99+ -
)99- .
{:: 	
logger;; 
.;; 

LogWarning;; 
(;; 
ex;;  
,;;  !
$str;;" g
,;;g h
User<< 
.<< 
Identity<< 
?<< 
.<< 
Name<< #
??<<$ &
$str<<' 0
)<<0 1
;<<1 2
return== 

StatusCode== 
(== 
StatusCodes== )
.==) *
Status403Forbidden==* <
,==< =
new==> A
{==B C
message==D K
===L M
ex==N P
.==P Q
Message==Q X
}==Y Z
)==Z [
;==[ \
}>> 	
}?? 
[NN 

HttpDeleteNN 
(NN 
$strNN 
)NN 
]NN 
[OO  
ProducesResponseTypeOO 
(OO 
StatusCodesOO %
.OO% &
Status204NoContentOO& 8
)OO8 9
]OO9 :
[PP  
ProducesResponseTypePP 
(PP 
StatusCodesPP %
.PP% &!
Status401UnauthorizedPP& ;
)PP; <
]PP< =
[QQ  
ProducesResponseTypeQQ 
(QQ 
StatusCodesQQ %
.QQ% &
Status403ForbiddenQQ& 8
)QQ8 9
]QQ9 :
[RR  
ProducesResponseTypeRR 
(RR 
StatusCodesRR %
.RR% &
Status404NotFoundRR& 7
)RR7 8
]RR8 9
publicSS 

asyncSS 
TaskSS 
<SS 
IActionResultSS #
>SS# $
DeletePropositionSS% 6
(SS6 7
intSS7 :
idSS; =
)SS= >
{TT 
loggerUU 
.UU 
LogInformationUU 
(UU 
$strUU S
,UUS T
idUUU W
)UUW X
;UUX Y
tryWW 
{XX 	
varYY 
emailYY 
=YY 
UserYY 
.YY 
GetUserEmailOrThrowYY 0
(YY0 1
)YY1 2
;YY2 3
varZZ 
propositionZZ 
=ZZ 
awaitZZ #
propositionServiceZZ$ 6
.ZZ6 7)
DeletePropositionAsAdminAsyncZZ7 T
(ZZT U
idZZU W
,ZZW X
emailZZY ^
)ZZ^ _
;ZZ_ `
if\\ 
(\\ 
proposition\\ 
==\\ 
null\\ #
)\\# $
{]] 
logger^^ 
.^^ 
LogInformation^^ %
(^^% &
$str^^& ^
,^^^ _
id^^` b
)^^b c
;^^c d
return__ 
NotFound__ 
(__  
new__  #
{__$ %
message__& -
=__. /
$"__0 2
$str__2 F
{__F G
id__G I
}__I J
$str__J T
"__T U
}__V W
)__W X
;__X Y
}`` 
loggerbb 
.bb 
LogInformationbb !
(bb! "
$strbb" \
,bb\ ]
idbb^ `
,bb` a
emailbbb g
)bbg h
;bbh i
returndd 
	NoContentdd 
(dd 
)dd 
;dd 
}ee 	
catchff 
(ff '
UnauthorizedAccessExceptionff *
exff+ -
)ff- .
{gg 	
loggerhh 
.hh 

LogWarninghh 
(hh 
exhh  
,hh  !
$strhh" o
,hho p
idii 
,ii 
Userii 
.ii 
Identityii !
?ii! "
.ii" #
Nameii# '
??ii( *
$strii+ 4
)ii4 5
;ii5 6
returnjj 

StatusCodejj 
(jj 
StatusCodesjj )
.jj) *
Status403Forbiddenjj* <
,jj< =
newjj> A
{jjB C
messagejjD K
=jjL M
exjjN P
.jjP Q
MessagejjQ X
}jjY Z
)jjZ [
;jj[ \
}kk 	
}ll 
}mm µ
FC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\HealthController.cs
	namespace 	
Web
 
. 
Controllers 
; 
[ 
Route 
( 
$str 
) 
] 
[ 
ApiController 
] 
public 
class 
HealthController 
( 
EsnDevContext +
context, 3
,3 4
ILogger5 <
<< =
HealthController= M
>M N
loggerO U
)U V
:W X
ControllerBaseY g
{		 
[ 
HttpGet 
] 
[  
ProducesResponseType 
( 
StatusCodes %
.% &
Status200OK& 1
)1 2
]2 3
[  
ProducesResponseType 
( 
StatusCodes %
.% &'
Status503ServiceUnavailable& A
)A B
]B C
public 

async 
Task 
< 
ActionResult "
<" #
object# )
>) *
>* +
	GetHealth, 5
(5 6
)6 7
{ 
logger 
. 
LogInformation 
( 
$str 6
)6 7
;7 8
try 
{ 	
var 

canConnect 
= 
await "
context# *
.* +
Database+ 3
.3 4
CanConnectAsync4 C
(C D
)D E
;E F
var 
health 
= 
new 
{ 
status 
= 

canConnect #
?$ %
$str& /
:0 1
$str2 =
,= >
checks 
= 
new 
{ 
database 
= 

canConnect )
?* +
$str, 5
:6 7
$str8 C
}   
}!! 
;!! 
if## 
(## 
!## 

canConnect## 
)## 
{$$ 
logger%% 
.%% 

LogWarning%% !
(%%! "
$str%%" N
)%%N O
;%%O P
return&& 

StatusCode&& !
(&&! "
StatusCodes&&" -
.&&- .'
Status503ServiceUnavailable&&. I
,&&I J
health&&K Q
)&&Q R
;&&R S
}'' 
logger)) 
.)) 
LogInformation)) !
())! "
$str))" 7
)))7 8
;))8 9
return** 
Ok** 
(** 
health** 
)** 
;** 
}++ 	
catch,, 
(,, 
	Exception,, 
ex,, 
),, 
{-- 	
logger.. 
... 
LogError.. 
(.. 
ex.. 
,.. 
$str..  D
)..D E
;..E F
return00 

StatusCode00 
(00 
StatusCodes00 )
.00) *'
Status503ServiceUnavailable00* E
,00E F
new00G J
{11 
status22 
=22 
$str22 $
,22$ %
checks33 
=33 
new33 
{44 
database55 
=55 
$str55 *
}66 
}77 
)77 
;77 
}88 	
}99 
}:: êÁ
FC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\EventsController.cs
	namespace 	
Web
 
. 
Controllers 
; 
[ 
Route 
( 
$str 
) 
] 
[ 
ApiController 
] 
[ 
ServiceFilter 
( 
typeof 
( &
RequestLoggingActionFilter 0
)0 1
)1 2
]2 3
public 
class 
EventsController 
( 
Business &
.& '

Interfaces' 1
.1 2
IEventService2 ?
eventService@ L
,L M
BusinessN V
.V W

InterfacesW a
.a b!
IEventTemplateServiceb w!
eventTemplateService	x å
,
å ç
ILogger
é ï
<
ï ñ
EventsController
ñ ¶
>
¶ ß
logger
® Æ
)
Æ Ø
:
∞ ±
ControllerBase
≤ ¿
{ 
[ 
HttpGet 
] 
[  
ProducesResponseType 
( 
typeof  
(  !
PagedResult! ,
<, -
EventDto- 5
>5 6
)6 7
,7 8
StatusCodes9 D
.D E
Status200OKE P
)P Q
]Q R
public 

async 
Task 
< 
ActionResult "
<" #
PagedResult# .
<. /
EventDto/ 7
>7 8
>8 9
>9 :
	GetEvents; D
(D E
[E F
	FromQueryF O
]O P
PaginationParamsQ a

paginationb l
)l m
{ 
logger 
. 
LogInformation 
( 
$str _
,_ `

pagination 
. 

PageNumber !
,! "

pagination# -
.- .
PageSize. 6
)6 7
;7 8
var 
	userEmail 
= 
User 
. 
GetUserEmail )
() *
)* +
;+ ,
var 
events 
= 
await 
eventService '
.' (
GetAllEventsAsync( 9
(9 :

pagination: D
,D E
	userEmailF O
)O P
;P Q
logger 
. 
LogInformation 
( 
$str o
,o p
events 
. 
Items 
. 
Count 
, 
events  &
.& '

TotalCount' 1
,1 2
	userEmail3 <
??= ?
$str@ K
)K L
;L M
return 
Ok 
( 
events 
) 
; 
}   
["" 
	Authorize"" 
]"" 
[## 
HttpGet## 
(## 
$str## 
)## 
]## 
[$$  
ProducesResponseType$$ 
($$ 
typeof$$  
($$  !
IEnumerable$$! ,
<$$, -
EventDto$$- 5
>$$5 6
)$$6 7
,$$7 8
StatusCodes$$9 D
.$$D E
Status200OK$$E P
)$$P Q
]$$Q R
[%%  
ProducesResponseType%% 
(%% 
StatusCodes%% %
.%%% &!
Status401Unauthorized%%& ;
)%%; <
]%%< =
[&&  
ProducesResponseType&& 
(&& 
StatusCodes&& %
.&&% &
Status403Forbidden&&& 8
)&&8 9
]&&9 :
public'' 

async'' 
Task'' 
<'' 
ActionResult'' "
<''" #
IEnumerable''# .
<''. /
EventDto''/ 7
>''7 8
>''8 9
>''9 : 
GetAllEventsForAdmin''; O
(''O P
)''P Q
{(( 
logger)) 
.)) 
LogInformation)) 
()) 
$str)) E
)))E F
;))F G
var,, 
isAdmin,, 
=,, 
User,, 
.,, 
IsInRole,, #
(,,# $
$str,,$ +
),,+ ,
;,,, -
var-- 
studentType-- 
=-- 
User-- 
.-- 
Claims-- %
.--% &
FirstOrDefault--& 4
(--4 5
c--5 6
=>--7 9
c--: ;
.--; <
Type--< @
==--A C
$str--D Q
)--Q R
?--R S
.--S T
Value--T Y
;--Y Z
var.. 
isEsnMember.. 
=.. 
studentType.. %
==..& (
Bo..) +
...+ ,
	Constants.., 5
...5 6
StudentType..6 A
...A B
	EsnMember..B K
;..K L
if00 

(00 
!00 
isAdmin00 
&&00 
!00 
isEsnMember00 $
)00$ %
{11 	
logger22 
.22 

LogWarning22 
(22 
$str22 a
)22a b
;22b c
return33 
Forbid33 
(33 
)33 
;33 
}44 	
var66 
events66 
=66 
await66 
eventService66 '
.66' (%
GetAllEventsForAdminAsync66( A
(66A B
)66B C
;66C D
logger88 
.88 
LogInformation88 
(88 
$str88 q
,88q r
events88s y
.88y z
Count88z 
(	88 Ä
)
88Ä Å
)
88Å Ç
;
88Ç É
return:: 
Ok:: 
(:: 
events:: 
):: 
;:: 
};; 
[== 
HttpGet== 
(== 
$str== 
)== 
]== 
[>>  
ProducesResponseType>> 
(>> 
typeof>>  
(>>  !
EventDto>>! )
)>>) *
,>>* +
StatusCodes>>, 7
.>>7 8
Status200OK>>8 C
)>>C D
]>>D E
[??  
ProducesResponseType?? 
(?? 
StatusCodes?? %
.??% &
Status404NotFound??& 7
)??7 8
]??8 9
public@@ 

async@@ 
Task@@ 
<@@ 
ActionResult@@ "
<@@" #
EventDto@@# +
>@@+ ,
>@@, -
GetEvent@@. 6
(@@6 7
int@@7 :
id@@; =
)@@= >
{AA 
loggerBB 
.BB 
LogInformationBB 
(BB 
$strBB B
,BBB C
idBBD F
)BBF G
;BBG H
varDD 
	userEmailDD 
=DD 
UserDD 
.DD 
GetUserEmailDD )
(DD) *
)DD* +
;DD+ ,
varEE 
eventDtoEE 
=EE 
awaitEE 
eventServiceEE )
.EE) *
GetEventByIdAsyncEE* ;
(EE; <
idEE< >
,EE> ?
	userEmailEE@ I
)EEI J
;EEJ K
ifGG 

(GG 
eventDtoGG 
==GG 
nullGG 
)GG 
{HH 	
loggerII 
.II 
LogInformationII !
(II! "
$strII" C
,IIC D
idIIE G
)IIG H
;IIH I
returnJJ 
NotFoundJJ 
(JJ 
)JJ 
;JJ 
}KK 	
loggerMM 
.MM 
LogInformationMM 
(MM 
$strMM J
,MMJ K
idMML N
,MMN O
	userEmailMMP Y
??MMZ \
$strMM] h
)MMh i
;MMi j
returnOO 
OkOO 
(OO 
eventDtoOO 
)OO 
;OO 
}PP 
[RR 
	AuthorizeRR 
]RR 
[SS 
HttpPostSS 
]SS 
[TT  
ProducesResponseTypeTT 
(TT 
typeofTT  
(TT  !
EventDtoTT! )
)TT) *
,TT* +
StatusCodesTT, 7
.TT7 8
Status201CreatedTT8 H
)TTH I
]TTI J
[UU  
ProducesResponseTypeUU 
(UU 
StatusCodesUU %
.UU% &
Status400BadRequestUU& 9
)UU9 :
]UU: ;
[VV  
ProducesResponseTypeVV 
(VV 
StatusCodesVV %
.VV% &!
Status401UnauthorizedVV& ;
)VV; <
]VV< =
publicWW 

asyncWW 
TaskWW 
<WW 
ActionResultWW "
<WW" #
EventDtoWW# +
>WW+ ,
>WW, -
	PostEventWW. 7
(WW7 8
CreateEventDtoWW8 F
createEventDtoWWG U
)WWU V
{XX 
loggerYY 
.YY 
LogInformationYY 
(YY 
$strYY M
,YYM N
createEventDtoYYO ]
.YY] ^
TitleYY^ c
)YYc d
;YYd e
if[[ 

([[ 
![[ 

ModelState[[ 
.[[ 
IsValid[[ 
)[[  
{\\ 	
return]] 

BadRequest]] 
(]] 

ModelState]] (
)]]( )
;]]) *
}^^ 	
try`` 
{aa 	
varbb 
emailbb 
=bb 
Userbb 
.bb 
GetUserEmailOrThrowbb 0
(bb0 1
)bb1 2
;bb2 3
varcc 
eventDtocc 
=cc 
awaitcc  
eventServicecc! -
.cc- .
CreateEventAsynccc. >
(cc> ?
createEventDtocc? M
,ccM N
emailccO T
)ccT U
;ccU V
loggeree 
.ee 
LogInformationee !
(ee! "
$stree" D
,eeD E
eventDtoeeF N
.eeN O
TitleeeO T
)eeT U
;eeU V
returngg 
CreatedAtActiongg "
(gg" #
nameofgg# )
(gg) *
GetEventgg* 2
)gg2 3
,gg3 4
newgg5 8
{gg9 :
idgg; =
=gg> ?
eventDtogg@ H
.ggH I
IdggI K
}ggL M
,ggM N
eventDtoggO W
)ggW X
;ggX Y
}hh 	
catchii 
(ii '
UnauthorizedAccessExceptionii *
exii+ -
)ii- .
{jj 	
loggerkk 
.kk 

LogWarningkk 
(kk 
exkk  
,kk  !
$strkk" <
)kk< =
;kk= >
returnll 
Unauthorizedll 
(ll  
exll  "
.ll" #
Messagell# *
)ll* +
;ll+ ,
}mm 	
catchnn 
(nn %
InvalidOperationExceptionnn (
exnn) +
)nn+ ,
{oo 	
loggerpp 
.pp 

LogWarningpp 
(pp 
expp  
,pp  !
$strpp" G
)ppG H
;ppH I
returnqq 
Conflictqq 
(qq 
exqq 
.qq 
Messageqq &
)qq& '
;qq' (
}rr 	
catchss 
(ss 
DbUpdateExceptionss  
exss! #
)ss# $
whenss% )
(ss* +
exss+ -
.ss- .
InnerExceptionss. <
?ss< =
.ss= >
Messagess> E
?ssE F
.ssF G
ContainsssG O
(ssO P
$strssP m
)ssm n
==sso q
truessr v
)ssv w
{tt 	
loggeruu 
.uu 

LogWarninguu 
(uu 
exuu  
,uu  !
$struu" K
)uuK L
;uuL M
returnvv 
Conflictvv 
(vv 
$strvv V
)vvV W
;vvW X
}ww 	
catchxx 
(xx 
ArgumentExceptionxx  
exxx! #
)xx# $
{yy 	
loggerzz 
.zz 

LogWarningzz 
(zz 
exzz  
,zz  !
$strzz" @
)zz@ A
;zzA B
return{{ 

BadRequest{{ 
({{ 
ex{{  
.{{  !
Message{{! (
){{( )
;{{) *
}|| 	
}}} 
[ 
	Authorize 
] 
[
ÄÄ 
HttpPut
ÄÄ 
(
ÄÄ 
$str
ÄÄ 
)
ÄÄ 
]
ÄÄ 
[
ÅÅ "
ProducesResponseType
ÅÅ 
(
ÅÅ 
typeof
ÅÅ  
(
ÅÅ  !
EventDto
ÅÅ! )
)
ÅÅ) *
,
ÅÅ* +
StatusCodes
ÅÅ, 7
.
ÅÅ7 8
Status200OK
ÅÅ8 C
)
ÅÅC D
]
ÅÅD E
[
ÇÇ "
ProducesResponseType
ÇÇ 
(
ÇÇ 
StatusCodes
ÇÇ %
.
ÇÇ% &
Status404NotFound
ÇÇ& 7
)
ÇÇ7 8
]
ÇÇ8 9
[
ÉÉ "
ProducesResponseType
ÉÉ 
(
ÉÉ 
StatusCodes
ÉÉ %
.
ÉÉ% &#
Status401Unauthorized
ÉÉ& ;
)
ÉÉ; <
]
ÉÉ< =
public
ÑÑ 

async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
ActionResult
ÑÑ "
<
ÑÑ" #
EventDto
ÑÑ# +
>
ÑÑ+ ,
>
ÑÑ, -
PutEvent
ÑÑ. 6
(
ÑÑ6 7
int
ÑÑ7 :
id
ÑÑ; =
,
ÑÑ= >
EventDto
ÑÑ? G
eventDto
ÑÑH P
)
ÑÑP Q
{
ÖÖ 
logger
ÜÜ 
.
ÜÜ 
LogInformation
ÜÜ 
(
ÜÜ 
$str
ÜÜ U
,
ÜÜU V
id
ÜÜW Y
,
ÜÜY Z
eventDto
ÜÜ[ c
.
ÜÜc d
Title
ÜÜd i
)
ÜÜi j
;
ÜÜj k
try
àà 
{
ââ 	
var
ää 
email
ää 
=
ää 
User
ää 
.
ää !
GetUserEmailOrThrow
ää 0
(
ää0 1
)
ää1 2
;
ää2 3
var
ãã 
responseDto
ãã 
=
ãã 
await
ãã #
eventService
ãã$ 0
.
ãã0 1
UpdateEventAsync
ãã1 A
(
ããA B
id
ããB D
,
ããD E
eventDto
ããF N
,
ããN O
email
ããP U
)
ããU V
;
ããV W
if
çç 
(
çç 
responseDto
çç 
==
çç 
null
çç #
)
çç# $
{
éé 
logger
èè 
.
èè 
LogInformation
èè %
(
èè% &
$str
èè& G
,
èèG H
id
èèI K
)
èèK L
;
èèL M
return
êê 
NotFound
êê 
(
êê  
)
êê  !
;
êê! "
}
ëë 
logger
ìì 
.
ìì 
LogInformation
ìì !
(
ìì! "
$str
ìì" @
,
ìì@ A
id
ììB D
)
ììD E
;
ììE F
return
ïï 
Ok
ïï 
(
ïï 
responseDto
ïï !
)
ïï! "
;
ïï" #
}
ññ 	
catch
óó 
(
óó )
UnauthorizedAccessException
óó *
ex
óó+ -
)
óó- .
{
òò 	
logger
ôô 
.
ôô 

LogWarning
ôô 
(
ôô 
ex
ôô  
,
ôô  !
$str
ôô" D
,
ôôD E
id
ôôF H
)
ôôH I
;
ôôI J
return
öö 
Unauthorized
öö 
(
öö  
ex
öö  "
.
öö" #
Message
öö# *
)
öö* +
;
öö+ ,
}
õõ 	
}
úú 
[
ûû 
	Authorize
ûû 
]
ûû 
[
üü 

HttpDelete
üü 
(
üü 
$str
üü 
)
üü 
]
üü 
[
†† "
ProducesResponseType
†† 
(
†† 
StatusCodes
†† %
.
††% & 
Status204NoContent
††& 8
)
††8 9
]
††9 :
[
°° "
ProducesResponseType
°° 
(
°° 
StatusCodes
°° %
.
°°% &
Status404NotFound
°°& 7
)
°°7 8
]
°°8 9
[
¢¢ "
ProducesResponseType
¢¢ 
(
¢¢ 
StatusCodes
¢¢ %
.
¢¢% &#
Status401Unauthorized
¢¢& ;
)
¢¢; <
]
¢¢< =
public
££ 

async
££ 
Task
££ 
<
££ 
ActionResult
££ "
>
££" #
DeleteEvent
££$ /
(
££/ 0
int
££0 3
id
££4 6
)
££6 7
{
§§ 
logger
•• 
.
•• 
LogInformation
•• 
(
•• 
$str
•• E
,
••E F
id
••G I
)
••I J
;
••J K
try
ßß 
{
®® 	
var
©© 
email
©© 
=
©© 
User
©© 
.
©© !
GetUserEmailOrThrow
©© 0
(
©©0 1
)
©©1 2
;
©©2 3
var
™™ 
result
™™ 
=
™™ 
await
™™ 
eventService
™™ +
.
™™+ ,
DeleteEventAsync
™™, <
(
™™< =
id
™™= ?
,
™™? @
email
™™A F
)
™™F G
;
™™G H
if
¨¨ 
(
¨¨ 
!
¨¨ 
result
¨¨ 
)
¨¨ 
{
≠≠ 
logger
ÆÆ 
.
ÆÆ 
LogInformation
ÆÆ %
(
ÆÆ% &
$str
ÆÆ& J
,
ÆÆJ K
id
ÆÆL N
)
ÆÆN O
;
ÆÆO P
return
ØØ 
NotFound
ØØ 
(
ØØ  
)
ØØ  !
;
ØØ! "
}
∞∞ 
logger
≤≤ 
.
≤≤ 
LogInformation
≤≤ !
(
≤≤! "
$str
≤≤" C
,
≤≤C D
id
≤≤E G
)
≤≤G H
;
≤≤H I
return
¥¥ 
	NoContent
¥¥ 
(
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 	
catch
∂∂ 
(
∂∂ )
UnauthorizedAccessException
∂∂ *
ex
∂∂+ -
)
∂∂- .
{
∑∑ 	
logger
∏∏ 
.
∏∏ 

LogWarning
∏∏ 
(
∏∏ 
ex
∏∏  
,
∏∏  !
$str
∏∏" G
,
∏∏G H
id
∏∏I K
)
∏∏K L
;
∏∏L M
return
ππ 
Unauthorized
ππ 
(
ππ  
ex
ππ  "
.
ππ" #
Message
ππ# *
)
ππ* +
;
ππ+ ,
}
∫∫ 	
}
ªª 
[
ΩΩ 
	Authorize
ΩΩ 
]
ΩΩ 
[
ææ 
HttpPost
ææ 
(
ææ 
$str
ææ 
)
ææ 
]
ææ 
[
øø "
ProducesResponseType
øø 
(
øø 
StatusCodes
øø %
.
øø% &
Status200OK
øø& 1
)
øø1 2
]
øø2 3
[
¿¿ "
ProducesResponseType
¿¿ 
(
¿¿ 
StatusCodes
¿¿ %
.
¿¿% &#
Status401Unauthorized
¿¿& ;
)
¿¿; <
]
¿¿< =
[
¡¡ "
ProducesResponseType
¡¡ 
(
¡¡ 
StatusCodes
¡¡ %
.
¡¡% &
Status404NotFound
¡¡& 7
)
¡¡7 8
]
¡¡8 9
[
¬¬ "
ProducesResponseType
¬¬ 
(
¬¬ 
StatusCodes
¬¬ %
.
¬¬% &!
Status400BadRequest
¬¬& 9
)
¬¬9 :
]
¬¬: ;
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
ActionResult
√√ "
>
√√" #
RegisterForEvent
√√$ 4
(
√√4 5
int
√√5 8
id
√√9 ;
,
√√; <
RegisterEventDto
√√= M
surveyJsData
√√N Z
)
√√Z [
{
ƒƒ 
logger
≈≈ 
.
≈≈ 
LogInformation
≈≈ 
(
≈≈ 
$str
≈≈ R
,
≈≈R S
id
≈≈T V
)
≈≈V W
;
≈≈W X
try
«« 
{
»» 	
var
…… 
email
…… 
=
…… 
User
…… 
.
…… !
GetUserEmailOrThrow
…… 0
(
……0 1
)
……1 2
;
……2 3
var
   
message
   
=
   
await
   
eventService
    ,
.
  , -#
RegisterForEventAsync
  - B
(
  B C
id
  C E
,
  E F
email
  G L
,
  L M
surveyJsData
  N Z
.
  Z [
SurveyJsData
  [ g
)
  g h
;
  h i
logger
ÃÃ 
.
ÃÃ 
LogInformation
ÃÃ !
(
ÃÃ! "
$str
ÃÃ" P
,
ÃÃP Q
id
ÃÃR T
)
ÃÃT U
;
ÃÃU V
return
ŒŒ 
Ok
ŒŒ 
(
ŒŒ 
new
ŒŒ 
{
ŒŒ 
message
ŒŒ #
}
ŒŒ$ %
)
ŒŒ% &
;
ŒŒ& '
}
œœ 	
catch
–– 
(
–– )
UnauthorizedAccessException
–– *
ex
––+ -
)
––- .
{
—— 	
logger
““ 
.
““ 

LogWarning
““ 
(
““ 
ex
““  
,
““  !
$str
““" C
)
““C D
;
““D E
return
”” 
Unauthorized
”” 
(
””  
ex
””  "
.
””" #
Message
””# *
)
””* +
;
””+ ,
}
‘‘ 	
catch
’’ 
(
’’ "
KeyNotFoundException
’’ #
ex
’’$ &
)
’’& '
{
÷÷ 	
logger
◊◊ 
.
◊◊ 

LogWarning
◊◊ 
(
◊◊ 
ex
◊◊  
,
◊◊  !
$str
◊◊" K
,
◊◊K L
id
◊◊M O
)
◊◊O P
;
◊◊P Q
return
ÿÿ 
NotFound
ÿÿ 
(
ÿÿ 
ex
ÿÿ 
.
ÿÿ 
Message
ÿÿ &
)
ÿÿ& '
;
ÿÿ' (
}
ŸŸ 	
catch
⁄⁄ 
(
⁄⁄ '
InvalidOperationException
⁄⁄ (
ex
⁄⁄) +
)
⁄⁄+ ,
{
€€ 	
logger
‹‹ 
.
‹‹ 

LogWarning
‹‹ 
(
‹‹ 
ex
‹‹  
,
‹‹  !
$str
‹‹" Y
,
‹‹Y Z
id
‹‹[ ]
)
‹‹] ^
;
‹‹^ _
return
›› 

BadRequest
›› 
(
›› 
ex
››  
.
››  !
Message
››! (
)
››( )
;
››) *
}
ﬁﬁ 	
}
ﬂﬂ 
[
·· 
	Authorize
·· 
]
·· 
[
‚‚ 

HttpDelete
‚‚ 
(
‚‚ 
$str
‚‚ 
)
‚‚  
]
‚‚  !
[
„„ "
ProducesResponseType
„„ 
(
„„ 
StatusCodes
„„ %
.
„„% &
Status200OK
„„& 1
)
„„1 2
]
„„2 3
[
‰‰ "
ProducesResponseType
‰‰ 
(
‰‰ 
StatusCodes
‰‰ %
.
‰‰% &#
Status401Unauthorized
‰‰& ;
)
‰‰; <
]
‰‰< =
[
ÂÂ "
ProducesResponseType
ÂÂ 
(
ÂÂ 
StatusCodes
ÂÂ %
.
ÂÂ% &
Status404NotFound
ÂÂ& 7
)
ÂÂ7 8
]
ÂÂ8 9
public
ÊÊ 

async
ÊÊ 
Task
ÊÊ 
<
ÊÊ 
ActionResult
ÊÊ "
>
ÊÊ" #!
UnregisterFromEvent
ÊÊ$ 7
(
ÊÊ7 8
int
ÊÊ8 ;
id
ÊÊ< >
)
ÊÊ> ?
{
ÁÁ 
logger
ËË 
.
ËË 
LogInformation
ËË 
(
ËË 
$str
ËË U
,
ËËU V
id
ËËW Y
)
ËËY Z
;
ËËZ [
try
ÍÍ 
{
ÎÎ 	
var
ÏÏ 
email
ÏÏ 
=
ÏÏ 
User
ÏÏ 
.
ÏÏ !
GetUserEmailOrThrow
ÏÏ 0
(
ÏÏ0 1
)
ÏÏ1 2
;
ÏÏ2 3
var
ÌÌ 
message
ÌÌ 
=
ÌÌ 
await
ÌÌ 
eventService
ÌÌ  ,
.
ÌÌ, -&
UnregisterFromEventAsync
ÌÌ- E
(
ÌÌE F
id
ÌÌF H
,
ÌÌH I
email
ÌÌJ O
)
ÌÌO P
;
ÌÌP Q
logger
ÔÔ 
.
ÔÔ 
LogInformation
ÔÔ !
(
ÔÔ! "
$str
ÔÔ" S
,
ÔÔS T
id
ÔÔU W
)
ÔÔW X
;
ÔÔX Y
return
ÒÒ 
Ok
ÒÒ 
(
ÒÒ 
new
ÒÒ 
{
ÒÒ 
message
ÒÒ #
}
ÒÒ$ %
)
ÒÒ% &
;
ÒÒ& '
}
ÚÚ 	
catch
ÛÛ 
(
ÛÛ )
UnauthorizedAccessException
ÛÛ *
ex
ÛÛ+ -
)
ÛÛ- .
{
ÙÙ 	
logger
ıı 
.
ıı 

LogWarning
ıı 
(
ıı 
ex
ıı  
,
ıı  !
$str
ıı" F
)
ııF G
;
ııG H
return
ˆˆ 
Unauthorized
ˆˆ 
(
ˆˆ  
ex
ˆˆ  "
.
ˆˆ" #
Message
ˆˆ# *
)
ˆˆ* +
;
ˆˆ+ ,
}
˜˜ 	
catch
¯¯ 
(
¯¯ "
KeyNotFoundException
¯¯ #
ex
¯¯$ &
)
¯¯& '
{
˘˘ 	
logger
˙˙ 
.
˙˙ 

LogWarning
˙˙ 
(
˙˙ 
ex
˙˙  
,
˙˙  !
$str
˙˙" g
,
˙˙g h
id
˙˙i k
)
˙˙k l
;
˙˙l m
return
˚˚ 
NotFound
˚˚ 
(
˚˚ 
ex
˚˚ 
.
˚˚ 
Message
˚˚ &
)
˚˚& '
;
˚˚' (
}
¸¸ 	
}
˝˝ 
[
ˇˇ 
	Authorize
ˇˇ 
]
ˇˇ 
[
ÄÄ 
HttpGet
ÄÄ 
(
ÄÄ 
$str
ÄÄ !
)
ÄÄ! "
]
ÄÄ" #
[
ÅÅ "
ProducesResponseType
ÅÅ 
(
ÅÅ 
typeof
ÅÅ  
(
ÅÅ  !'
EventWithRegistrationsDto
ÅÅ! :
)
ÅÅ: ;
,
ÅÅ; <
StatusCodes
ÅÅ= H
.
ÅÅH I
Status200OK
ÅÅI T
)
ÅÅT U
]
ÅÅU V
[
ÇÇ "
ProducesResponseType
ÇÇ 
(
ÇÇ 
StatusCodes
ÇÇ %
.
ÇÇ% &
Status404NotFound
ÇÇ& 7
)
ÇÇ7 8
]
ÇÇ8 9
public
ÉÉ 

async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
ActionResult
ÉÉ "
<
ÉÉ" #'
EventWithRegistrationsDto
ÉÉ# <
>
ÉÉ< =
>
ÉÉ= >#
GetEventRegistrations
ÉÉ? T
(
ÉÉT U
int
ÉÉU X
id
ÉÉY [
)
ÉÉ[ \
{
ÑÑ 
logger
ÖÖ 
.
ÖÖ 
LogInformation
ÖÖ 
(
ÖÖ 
$str
ÖÖ W
,
ÖÖW X
id
ÖÖY [
)
ÖÖ[ \
;
ÖÖ\ ]
var
áá 
result
áá 
=
áá 
await
áá 
eventService
áá '
.
áá' ((
GetEventRegistrationsAsync
áá( B
(
ááB C
id
ááC E
)
ááE F
;
ááF G
if
ââ 

(
ââ 
result
ââ 
==
ââ 
null
ââ 
)
ââ 
{
ää 	
logger
ãã 
.
ãã 
LogInformation
ãã !
(
ãã! "
$str
ãã" P
,
ããP Q
id
ããR T
)
ããT U
;
ããU V
return
åå 
NotFound
åå 
(
åå 
$str
åå -
)
åå- .
;
åå. /
}
çç 	
logger
èè 
.
èè 
LogInformation
èè 
(
èè 
$str
èè Q
,
èèQ R
id
èèS U
)
èèU V
;
èèV W
return
ëë 
Ok
ëë 
(
ëë 
result
ëë 
)
ëë 
;
ëë 
}
íí 
[
ïï 
HttpGet
ïï 
(
ïï 
$str
ïï 
)
ïï 
]
ïï 
[
ññ "
ProducesResponseType
ññ 
(
ññ 
typeof
ññ  
(
ññ  !
PagedResult
ññ! ,
<
ññ, -
EventTemplateDto
ññ- =
>
ññ= >
)
ññ> ?
,
ññ? @
StatusCodes
ññA L
.
ññL M
Status200OK
ññM X
)
ññX Y
]
ññY Z
public
óó 

async
óó 
Task
óó 
<
óó 
ActionResult
óó "
<
óó" #
PagedResult
óó# .
<
óó. /
EventTemplateDto
óó/ ?
>
óó? @
>
óó@ A
>
óóA B
GetEventTemplates
óóC T
(
óóT U
[
óóU V
	FromQuery
óóV _
]
óó_ `
PaginationParams
óóa q

pagination
óór |
)
óó| }
{
òò 
logger
ôô 
.
ôô 
LogInformation
ôô 
(
ôô 
$str
ôô g
,
ôôg h

pagination
öö 
.
öö 

PageNumber
öö !
,
öö! "

pagination
öö# -
.
öö- .
PageSize
öö. 6
)
öö6 7
;
öö7 8
var
úú 
	templates
úú 
=
úú 
await
úú "
eventTemplateService
úú 2
.
úú2 3"
GetAllTemplatesAsync
úú3 G
(
úúG H

pagination
úúH R
)
úúR S
;
úúS T
logger
ûû 
.
ûû 
LogInformation
ûû 
(
ûû 
$str
ûû i
,
ûûi j
	templates
üü 
.
üü 
Items
üü 
.
üü 
Count
üü !
,
üü! "
	templates
üü# ,
.
üü, -

TotalCount
üü- 7
)
üü7 8
;
üü8 9
return
°° 
Ok
°° 
(
°° 
	templates
°° 
)
°° 
;
°° 
}
¢¢ 
[
§§ 
HttpGet
§§ 
(
§§ 
$str
§§ 
)
§§ 
]
§§ 
[
•• "
ProducesResponseType
•• 
(
•• 
typeof
••  
(
••  !
EventTemplateDto
••! 1
)
••1 2
,
••2 3
StatusCodes
••4 ?
.
••? @
Status200OK
••@ K
)
••K L
]
••L M
[
¶¶ "
ProducesResponseType
¶¶ 
(
¶¶ 
StatusCodes
¶¶ %
.
¶¶% &
Status404NotFound
¶¶& 7
)
¶¶7 8
]
¶¶8 9
public
ßß 

async
ßß 
Task
ßß 
<
ßß 
ActionResult
ßß "
<
ßß" #
EventTemplateDto
ßß# 3
>
ßß3 4
>
ßß4 5
GetEventTemplate
ßß6 F
(
ßßF G
int
ßßG J
id
ßßK M
)
ßßM N
{
®® 
logger
©© 
.
©© 
LogInformation
©© 
(
©© 
$str
©© J
,
©©J K
id
©©L N
)
©©N O
;
©©O P
var
´´ 
template
´´ 
=
´´ 
await
´´ "
eventTemplateService
´´ 1
.
´´1 2"
GetTemplateByIdAsync
´´2 F
(
´´F G
id
´´G I
)
´´I J
;
´´J K
if
≠≠ 

(
≠≠ 
template
≠≠ 
==
≠≠ 
null
≠≠ 
)
≠≠ 
{
ÆÆ 	
logger
ØØ 
.
ØØ 
LogInformation
ØØ !
(
ØØ! "
$str
ØØ" N
,
ØØN O
id
ØØP R
)
ØØR S
;
ØØS T
return
∞∞ 
NotFound
∞∞ 
(
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 	
logger
≥≥ 
.
≥≥ 
LogInformation
≥≥ 
(
≥≥ 
$str
≥≥ D
,
≥≥D E
id
≥≥F H
)
≥≥H I
;
≥≥I J
return
µµ 
Ok
µµ 
(
µµ 
template
µµ 
)
µµ 
;
µµ 
}
∂∂ 
[
∏∏ 
	Authorize
∏∏ 
]
∏∏ 
[
ππ 
HttpPost
ππ 
(
ππ 
$str
ππ 
)
ππ 
]
ππ 
[
∫∫ "
ProducesResponseType
∫∫ 
(
∫∫ 
typeof
∫∫  
(
∫∫  !
EventTemplateDto
∫∫! 1
)
∫∫1 2
,
∫∫2 3
StatusCodes
∫∫4 ?
.
∫∫? @
Status201Created
∫∫@ P
)
∫∫P Q
]
∫∫Q R
[
ªª "
ProducesResponseType
ªª 
(
ªª 
StatusCodes
ªª %
.
ªª% &!
Status400BadRequest
ªª& 9
)
ªª9 :
]
ªª: ;
[
ºº "
ProducesResponseType
ºº 
(
ºº 
StatusCodes
ºº %
.
ºº% &*
Status500InternalServerError
ºº& B
)
ººB C
]
ººC D
public
ΩΩ 

async
ΩΩ 
Task
ΩΩ 
<
ΩΩ 
ActionResult
ΩΩ "
<
ΩΩ" #
EventTemplateDto
ΩΩ# 3
>
ΩΩ3 4
>
ΩΩ4 5
PostEventTemplate
ΩΩ6 G
(
ΩΩG H$
CreateEventTemplateDto
ΩΩH ^
createTemplateDto
ΩΩ_ p
)
ΩΩp q
{
ææ 
logger
øø 
.
øø 
LogInformation
øø 
(
øø 
$str
øø U
,
øøU V
createTemplateDto
øøW h
.
øøh i
Title
øøi n
)
øøn o
;
øøo p
try
¡¡ 
{
¬¬ 	
var
√√ 
template
√√ 
=
√√ 
await
√√  "
eventTemplateService
√√! 5
.
√√5 6!
CreateTemplateAsync
√√6 I
(
√√I J
createTemplateDto
√√J [
)
√√[ \
;
√√\ ]
logger
≈≈ 
.
≈≈ 
LogInformation
≈≈ !
(
≈≈! "
$str
≈≈" L
,
≈≈L M
template
≈≈N V
.
≈≈V W
Title
≈≈W \
)
≈≈\ ]
;
≈≈] ^
return
«« 
CreatedAtAction
«« "
(
««" #
nameof
««# )
(
««) *
GetEventTemplate
««* :
)
««: ;
,
««; <
new
««= @
{
««A B
id
««C E
=
««F G
template
««H P
.
««P Q
Id
««Q S
}
««T U
,
««U V
template
««W _
)
««_ `
;
««` a
}
»» 	
catch
…… 
(
…… 
	Exception
…… 
ex
…… 
)
…… 
{
   	
logger
ÀÀ 
.
ÀÀ 
LogError
ÀÀ 
(
ÀÀ 
ex
ÀÀ 
,
ÀÀ 
$str
ÀÀ  M
)
ÀÀM N
;
ÀÀN O
return
ÃÃ 

StatusCode
ÃÃ 
(
ÃÃ 
$num
ÃÃ !
,
ÃÃ! "
$str
ÃÃ# R
)
ÃÃR S
;
ÃÃS T
}
ÕÕ 	
}
ŒŒ 
[
–– 
	Authorize
–– 
]
–– 
[
—— 
HttpPut
—— 
(
—— 
$str
—— 
)
—— 
]
—— 
[
““ "
ProducesResponseType
““ 
(
““ 
typeof
““  
(
““  !
EventTemplateDto
““! 1
)
““1 2
,
““2 3
StatusCodes
““4 ?
.
““? @
Status200OK
““@ K
)
““K L
]
““L M
[
”” "
ProducesResponseType
”” 
(
”” 
StatusCodes
”” %
.
””% &
Status404NotFound
””& 7
)
””7 8
]
””8 9
[
‘‘ "
ProducesResponseType
‘‘ 
(
‘‘ 
StatusCodes
‘‘ %
.
‘‘% &*
Status500InternalServerError
‘‘& B
)
‘‘B C
]
‘‘C D
public
’’ 

async
’’ 
Task
’’ 
<
’’ 
ActionResult
’’ "
<
’’" #
EventTemplateDto
’’# 3
>
’’3 4
>
’’4 5
PutEventTemplate
’’6 F
(
’’F G
int
’’G J
id
’’K M
,
’’M N
EventTemplateDto
’’O _
templateDto
’’` k
)
’’k l
{
÷÷ 
logger
◊◊ 
.
◊◊ 
LogInformation
◊◊ 
(
◊◊ 
$str
◊◊ ]
,
◊◊] ^
id
◊◊_ a
,
◊◊a b
templateDto
◊◊c n
.
◊◊n o
Title
◊◊o t
)
◊◊t u
;
◊◊u v
try
ŸŸ 
{
⁄⁄ 	
var
€€ 
responseDto
€€ 
=
€€ 
await
€€ #"
eventTemplateService
€€$ 8
.
€€8 9!
UpdateTemplateAsync
€€9 L
(
€€L M
id
€€M O
,
€€O P
templateDto
€€Q \
)
€€\ ]
;
€€] ^
if
›› 
(
›› 
responseDto
›› 
==
›› 
null
›› #
)
››# $
{
ﬁﬁ 
logger
ﬂﬂ 
.
ﬂﬂ 
LogInformation
ﬂﬂ %
(
ﬂﬂ% &
$str
ﬂﬂ& R
,
ﬂﬂR S
id
ﬂﬂT V
)
ﬂﬂV W
;
ﬂﬂW X
return
‡‡ 
NotFound
‡‡ 
(
‡‡  
)
‡‡  !
;
‡‡! "
}
·· 
logger
„„ 
.
„„ 
LogInformation
„„ !
(
„„! "
$str
„„" H
,
„„H I
id
„„J L
)
„„L M
;
„„M N
return
ÂÂ 
Ok
ÂÂ 
(
ÂÂ 
responseDto
ÂÂ !
)
ÂÂ! "
;
ÂÂ" #
}
ÊÊ 	
catch
ÁÁ 
(
ÁÁ 
	Exception
ÁÁ 
ex
ÁÁ 
)
ÁÁ 
{
ËË 	
logger
ÈÈ 
.
ÈÈ 
LogError
ÈÈ 
(
ÈÈ 
ex
ÈÈ 
,
ÈÈ 
$str
ÈÈ  Q
,
ÈÈQ R
id
ÈÈS U
)
ÈÈU V
;
ÈÈV W
return
ÍÍ 

StatusCode
ÍÍ 
(
ÍÍ 
$num
ÍÍ !
,
ÍÍ! "
$str
ÍÍ# R
)
ÍÍR S
;
ÍÍS T
}
ÎÎ 	
}
ÏÏ 
[
ÓÓ 
	Authorize
ÓÓ 
]
ÓÓ 
[
ÔÔ 

HttpDelete
ÔÔ 
(
ÔÔ 
$str
ÔÔ  
)
ÔÔ  !
]
ÔÔ! "
[
 "
ProducesResponseType
 
(
 
StatusCodes
 %
.
% & 
Status204NoContent
& 8
)
8 9
]
9 :
[
ÒÒ "
ProducesResponseType
ÒÒ 
(
ÒÒ 
StatusCodes
ÒÒ %
.
ÒÒ% &
Status404NotFound
ÒÒ& 7
)
ÒÒ7 8
]
ÒÒ8 9
[
ÚÚ "
ProducesResponseType
ÚÚ 
(
ÚÚ 
StatusCodes
ÚÚ %
.
ÚÚ% &*
Status500InternalServerError
ÚÚ& B
)
ÚÚB C
]
ÚÚC D
public
ÛÛ 

async
ÛÛ 
Task
ÛÛ 
<
ÛÛ 
ActionResult
ÛÛ "
>
ÛÛ" #!
DeleteEventTemplate
ÛÛ$ 7
(
ÛÛ7 8
int
ÛÛ8 ;
id
ÛÛ< >
)
ÛÛ> ?
{
ÙÙ 
logger
ıı 
.
ıı 
LogInformation
ıı 
(
ıı 
$str
ıı M
,
ııM N
id
ııO Q
)
ııQ R
;
ııR S
try
˜˜ 
{
¯¯ 	
var
˘˘ 
result
˘˘ 
=
˘˘ 
await
˘˘ "
eventTemplateService
˘˘ 3
.
˘˘3 4!
DeleteTemplateAsync
˘˘4 G
(
˘˘G H
id
˘˘H J
)
˘˘J K
;
˘˘K L
if
˚˚ 
(
˚˚ 
!
˚˚ 
result
˚˚ 
)
˚˚ 
{
¸¸ 
logger
˝˝ 
.
˝˝ 
LogInformation
˝˝ %
(
˝˝% &
$str
˝˝& U
,
˝˝U V
id
˝˝W Y
)
˝˝Y Z
;
˝˝Z [
return
˛˛ 
NotFound
˛˛ 
(
˛˛  
)
˛˛  !
;
˛˛! "
}
ˇˇ 
logger
ÅÅ 
.
ÅÅ 
LogInformation
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" K
,
ÅÅK L
id
ÅÅM O
)
ÅÅO P
;
ÅÅP Q
return
ÉÉ 
	NoContent
ÉÉ 
(
ÉÉ 
)
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
ex
ÖÖ 
)
ÖÖ 
{
ÜÜ 	
logger
áá 
.
áá 
LogError
áá 
(
áá 
ex
áá 
,
áá 
$str
áá  T
,
ááT U
id
ááV X
)
ááX Y
;
ááY Z
return
àà 

StatusCode
àà 
(
àà 
$num
àà !
,
àà! "
$str
àà# R
)
ààR S
;
ààS T
}
ââ 	
}
ää 
[
åå 
	Authorize
åå 
]
åå 
[
çç 
HttpPost
çç 
(
çç 
$str
çç 
)
çç 
]
çç 
[
éé "
ProducesResponseType
éé 
(
éé 
typeof
éé  
(
éé  !
EventDto
éé! )
)
éé) *
,
éé* +
StatusCodes
éé, 7
.
éé7 8
Status201Created
éé8 H
)
ééH I
]
ééI J
[
èè "
ProducesResponseType
èè 
(
èè 
StatusCodes
èè %
.
èè% &!
Status400BadRequest
èè& 9
)
èè9 :
]
èè: ;
[
êê "
ProducesResponseType
êê 
(
êê 
StatusCodes
êê %
.
êê% &#
Status401Unauthorized
êê& ;
)
êê; <
]
êê< =
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
ActionResult
ëë "
<
ëë" #
EventDto
ëë# +
>
ëë+ ,
>
ëë, -%
CreateEventFromTemplate
ëë. E
(
ëëE F(
CreateEventFromTemplateDto
ëëF `(
createEventFromTemplateDto
ëëa {
)
ëë{ |
{
íí 
logger
ìì 
.
ìì 
LogInformation
ìì 
(
ìì 
$str
ìì w
,
ììw x(
createEventFromTemplateDto
îî &
.
îî& '

TemplateId
îî' 1
,
îî1 2(
createEventFromTemplateDto
îî3 M
.
îîM N
Title
îîN S
)
îîS T
;
îîT U
try
ññ 
{
óó 	
var
òò 
email
òò 
=
òò 
User
òò 
.
òò !
GetUserEmailOrThrow
òò 0
(
òò0 1
)
òò1 2
;
òò2 3
var
ôô 
eventDto
ôô 
=
ôô 
await
ôô  "
eventTemplateService
ôô! 5
.
ôô5 6*
CreateEventFromTemplateAsync
ôô6 R
(
ôôR S(
createEventFromTemplateDto
ôôS m
,
ôôm n
email
ôôo t
)
ôôt u
;
ôôu v
logger
õõ 
.
õõ 
LogInformation
õõ !
(
õõ! "
$str
õõ" b
,
õõb c(
createEventFromTemplateDto
õõd ~
.
õõ~ 

TemplateIdõõ â
)õõâ ä
;õõä ã
return
ùù 
CreatedAtAction
ùù "
(
ùù" #
nameof
ùù# )
(
ùù) *
GetEvent
ùù* 2
)
ùù2 3
,
ùù3 4
new
ùù5 8
{
ùù9 :
id
ùù; =
=
ùù> ?
eventDto
ùù@ H
.
ùùH I
Id
ùùI K
}
ùùL M
,
ùùM N
eventDto
ùùO W
)
ùùW X
;
ùùX Y
}
ûû 	
catch
üü 
(
üü )
UnauthorizedAccessException
üü *
ex
üü+ -
)
üü- .
{
†† 	
logger
°° 
.
°° 

LogWarning
°° 
(
°° 
ex
°°  
,
°°  !
$str
°°" J
)
°°J K
;
°°K L
return
¢¢ 
Unauthorized
¢¢ 
(
¢¢  
ex
¢¢  "
.
¢¢" #
Message
¢¢# *
)
¢¢* +
;
¢¢+ ,
}
££ 	
catch
§§ 
(
§§ 
ArgumentException
§§  
ex
§§! #
)
§§# $
{
•• 	
logger
¶¶ 
.
¶¶ 

LogWarning
¶¶ 
(
¶¶ 
ex
¶¶  
,
¶¶  !
$str
¶¶" N
)
¶¶N O
;
¶¶O P
return
ßß 

BadRequest
ßß 
(
ßß 
ex
ßß  
.
ßß  !
Message
ßß! (
)
ßß( )
;
ßß) *
}
®® 	
}
©© 
[
´´ 
	Authorize
´´ 
]
´´ 
[
¨¨ 
HttpPost
¨¨ 
(
¨¨ 
$str
¨¨ %
)
¨¨% &
]
¨¨& '
[
≠≠ "
ProducesResponseType
≠≠ 
(
≠≠ 
typeof
≠≠  
(
≠≠  !
EventTemplateDto
≠≠! 1
)
≠≠1 2
,
≠≠2 3
StatusCodes
≠≠4 ?
.
≠≠? @
Status201Created
≠≠@ P
)
≠≠P Q
]
≠≠Q R
[
ÆÆ "
ProducesResponseType
ÆÆ 
(
ÆÆ 
StatusCodes
ÆÆ %
.
ÆÆ% &
Status404NotFound
ÆÆ& 7
)
ÆÆ7 8
]
ÆÆ8 9
public
ØØ 

async
ØØ 
Task
ØØ 
<
ØØ 
ActionResult
ØØ "
<
ØØ" #
EventTemplateDto
ØØ# 3
>
ØØ3 4
>
ØØ4 5!
SaveEventAsTemplate
ØØ6 I
(
ØØI J
int
ØØJ M
id
ØØN P
)
ØØP Q
{
∞∞ 
logger
±± 
.
±± 
LogInformation
±± 
(
±± 
$str
±± U
,
±±U V
id
±±W Y
)
±±Y Z
;
±±Z [
try
≥≥ 
{
¥¥ 	
var
µµ 
templateDto
µµ 
=
µµ 
await
µµ #"
eventTemplateService
µµ$ 8
.
µµ8 9&
SaveEventAsTemplateAsync
µµ9 Q
(
µµQ R
id
µµR T
)
µµT U
;
µµU V
logger
∑∑ 
.
∑∑ 
LogInformation
∑∑ !
(
∑∑! "
$str
∑∑" S
,
∑∑S T
id
∑∑U W
)
∑∑W X
;
∑∑X Y
return
ππ 
CreatedAtAction
ππ "
(
ππ" #
nameof
ππ# )
(
ππ) *
GetEventTemplate
ππ* :
)
ππ: ;
,
ππ; <
new
ππ= @
{
ππA B
id
ππC E
=
ππF G
templateDto
ππH S
.
ππS T
Id
ππT V
}
ππW X
,
ππX Y
templateDto
ππZ e
)
ππe f
;
ππf g
}
∫∫ 	
catch
ªª 
(
ªª 
ArgumentException
ªª  
ex
ªª! #
)
ªª# $
{
ºº 	
logger
ΩΩ 
.
ΩΩ 

LogWarning
ΩΩ 
(
ΩΩ 
ex
ΩΩ  
,
ΩΩ  !
$str
ΩΩ" N
,
ΩΩN O
id
ΩΩP R
)
ΩΩR S
;
ΩΩS T
return
ææ 
NotFound
ææ 
(
ææ 
ex
ææ 
.
ææ 
Message
ææ &
)
ææ& '
;
ææ' (
}
øø 	
}
¿¿ 
}¡¡ Õw
IC:\Users\micha\Projects\ESN-WebApi\Web\Controllers\CalendarsController.cs
	namespace		 	
Web		
 
.		 
Controllers		 
;		 
[ 
Route 
( 
$str 
) 
] 
[ 
ApiController 
] 
[ 
ServiceFilter 
( 
typeof 
( &
RequestLoggingActionFilter 0
)0 1
)1 2
]2 3
public 
class 
CalendarsController  
(  !
Business! )
.) *

Interfaces* 4
.4 5
ICalendarService5 E
calendarServiceF U
,U V
ILoggerW ^
<^ _
CalendarsController_ r
>r s
loggert z
)z {
:| }
ControllerBase	~ å
{ 
[ 
HttpGet 
] 
[  
ProducesResponseType 
( 
typeof  
(  !
PagedResult! ,
<, -
CalendarDto- 8
>8 9
)9 :
,: ;
StatusCodes< G
.G H
Status200OKH S
)S T
]T U
public 

async 
Task 
< 
ActionResult "
<" #
PagedResult# .
<. /
CalendarDto/ :
>: ;
>; <
>< =
GetCalendars> J
(J K
[K L
	FromQueryL U
]U V
PaginationParamsW g

paginationh r
)r s
{ 
logger 
. 
LogInformation 
( 
$str b
,b c

pagination 
. 

PageNumber !
,! "

pagination# -
.- .
PageSize. 6
)6 7
;7 8
var 
	calendars 
= 
await 
calendarService -
.- . 
GetAllCalendarsAsync. B
(B C

paginationC M
)M N
;N O
logger 
. 
LogInformation 
( 
$str d
,d e
	calendars 
. 
Items 
. 
Count !
,! "
	calendars# ,
., -

TotalCount- 7
)7 8
;8 9
return 
Ok 
( 
	calendars 
) 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
[    
ProducesResponseType   
(   
typeof    
(    !
CalendarDto  ! ,
)  , -
,  - .
StatusCodes  / :
.  : ;
Status200OK  ; F
)  F G
]  G H
[!!  
ProducesResponseType!! 
(!! 
StatusCodes!! %
.!!% &
Status404NotFound!!& 7
)!!7 8
]!!8 9
public"" 

async"" 
Task"" 
<"" 
ActionResult"" "
<""" #
CalendarDto""# .
>"". /
>""/ 0
GetCalendar""1 <
(""< =
int""= @
id""A C
)""C D
{## 
logger$$ 
.$$ 
LogInformation$$ 
($$ 
$str$$ E
,$$E F
id$$G I
)$$I J
;$$J K
var&& 
calendar&& 
=&& 
await&& 
calendarService&& ,
.&&, - 
GetCalendarByIdAsync&&- A
(&&A B
id&&B D
)&&D E
;&&E F
if(( 

((( 
calendar(( 
==(( 
null(( 
)(( 
{)) 	
logger** 
.** 
LogInformation** !
(**! "
$str**" I
,**I J
id**K M
)**M N
;**N O
return++ 
NotFound++ 
(++ 
)++ 
;++ 
},, 	
logger.. 
... 
LogInformation.. 
(.. 
$str.. ?
,..? @
id..A C
)..C D
;..D E
return00 
Ok00 
(00 
calendar00 
)00 
;00 
}11 
[33 
HttpGet33 
(33 
$str33  
)33  !
]33! "
[44  
ProducesResponseType44 
(44 
typeof44  
(44  !
IEnumerable44! ,
<44, -
CalendarDto44- 8
>448 9
)449 :
,44: ;
StatusCodes44< G
.44G H
Status200OK44H S
)44S T
]44T U
public55 

async55 
Task55 
<55 
ActionResult55 "
<55" #
IEnumerable55# .
<55. /
CalendarDto55/ :
>55: ;
>55; <
>55< =
GetCalendarsByEvent55> Q
(55Q R
int55R U
eventId55V ]
)55] ^
{66 
logger77 
.77 
LogInformation77 
(77 
$str77 Z
,77Z [
eventId77\ c
)77c d
;77d e
var99 
	calendars99 
=99 
await99 
calendarService99 -
.99- .&
GetCalendarsByEventIdAsync99. H
(99H I
eventId99I P
)99P Q
;99Q R
logger;; 
.;; 
LogInformation;; 
(;; 
$str;; T
,;;T U
eventId;;V ]
);;] ^
;;;^ _
return== 
Ok== 
(== 
	calendars== 
)== 
;== 
}>> 
[@@ 
HttpGet@@ 
(@@ 
$str@@ 
)@@ 
]@@ 
[AA  
ProducesResponseTypeAA 
(AA 
typeofAA  
(AA  !
IEnumerableAA! ,
<AA, -
CalendarDtoAA- 8
>AA8 9
)AA9 :
,AA: ;
StatusCodesAA< G
.AAG H
Status200OKAAH S
)AAS T
]AAT U
publicBB 

asyncBB 
TaskBB 
<BB 
ActionResultBB "
<BB" #
IEnumerableBB# .
<BB. /
CalendarDtoBB/ :
>BB: ;
>BB; <
>BB< =!
GetAvailableCalendarsBB> S
(BBS T
)BBT U
{CC 
loggerDD 
.DD 
LogInformationDD 
(DD 
$strDD F
)DDF G
;DDG H
varFF 
	calendarsFF 
=FF 
awaitFF 
calendarServiceFF -
.FF- .&
GetAvailableCalendarsAsyncFF. H
(FFH I
)FFI J
;FFJ K
loggerHH 
.HH 
LogInformationHH 
(HH 
$strHH g
,HHg h
	calendarsII 
.II 
CountII 
(II 
)II 
)II 
;II 
returnKK 
OkKK 
(KK 
	calendarsKK 
)KK 
;KK 
}LL 
[NN 
	AuthorizeNN 
]NN 
[OO 
HttpPostOO 
]OO 
[PP  
ProducesResponseTypePP 
(PP 
typeofPP  
(PP  !
CalendarDtoPP! ,
)PP, -
,PP- .
StatusCodesPP/ :
.PP: ;
Status201CreatedPP; K
)PPK L
]PPL M
[QQ  
ProducesResponseTypeQQ 
(QQ 
StatusCodesQQ %
.QQ% &
Status400BadRequestQQ& 9
)QQ9 :
]QQ: ;
publicRR 

asyncRR 
TaskRR 
<RR 
ActionResultRR "
<RR" #
CalendarDtoRR# .
>RR. /
>RR/ 0
PostCalendarRR1 =
(RR= >
CalendarCreateDtoRR> O
	createDtoRRP Y
)RRY Z
{SS 
loggerTT 
.TT 
LogInformationTT 
(TT 
$strTT =
)TT= >
;TT> ?
ifVV 

(VV 
!VV 

ModelStateVV 
.VV 
IsValidVV 
)VV  
{WW 	
returnXX 

BadRequestXX 
(XX 

ModelStateXX (
)XX( )
;XX) *
}YY 	
var[[ 
calendar[[ 
=[[ 
await[[ 
calendarService[[ ,
.[[, -
CreateCalendarAsync[[- @
([[@ A
	createDto[[A J
)[[J K
;[[K L
logger]] 
.]] 
LogInformation]] 
(]] 
$str]] K
,]]K L
calendar]]M U
.]]U V
Id]]V X
)]]X Y
;]]Y Z
return__ 
CreatedAtAction__ 
(__ 
nameof__ %
(__% &
GetCalendar__& 1
)__1 2
,__2 3
new__4 7
{__8 9
id__: <
=__= >
calendar__? G
.__G H
Id__H J
}__K L
,__L M
calendar__N V
)__V W
;__W X
}`` 
[bb 
	Authorizebb 
]bb 
[cc 
HttpPutcc 
(cc 
$strcc 
)cc 
]cc 
[dd  
ProducesResponseTypedd 
(dd 
typeofdd  
(dd  !
CalendarDtodd! ,
)dd, -
,dd- .
StatusCodesdd/ :
.dd: ;
Status200OKdd; F
)ddF G
]ddG H
[ee  
ProducesResponseTypeee 
(ee 
StatusCodesee %
.ee% &
Status400BadRequestee& 9
)ee9 :
]ee: ;
[ff  
ProducesResponseTypeff 
(ff 
StatusCodesff %
.ff% &
Status404NotFoundff& 7
)ff7 8
]ff8 9
[gg  
ProducesResponseTypegg 
(gg 
StatusCodesgg %
.gg% &!
Status401Unauthorizedgg& ;
)gg; <
]gg< =
publichh 

asynchh 
Taskhh 
<hh 
ActionResulthh "
<hh" #
CalendarDtohh# .
>hh. /
>hh/ 0
PutCalendarhh1 <
(hh< =
inthh= @
idhhA C
,hhC D
CalendarUpdateDtohhE V
	updateDtohhW `
)hh` a
{ii 
loggerjj 
.jj 
LogInformationjj 
(jj 
$strjj E
,jjE F
idjjG I
)jjI J
;jjJ K
ifll 

(ll 
!ll 

ModelStatell 
.ll 
IsValidll 
)ll  
{mm 	
returnnn 

BadRequestnn 
(nn 

ModelStatenn (
)nn( )
;nn) *
}oo 	
tryqq 
{rr 	
varss 
emailss 
=ss 
Userss 
.ss 
GetUserEmailOrThrowss 0
(ss0 1
)ss1 2
;ss2 3
vartt 
calendartt 
=tt 
awaittt  
calendarServicett! 0
.tt0 1
UpdateCalendarAsynctt1 D
(ttD E
idttE G
,ttG H
	updateDtottI R
,ttR S
emailttT Y
)ttY Z
;ttZ [
ifvv 
(vv 
calendarvv 
==vv 
nullvv  
)vv  !
{ww 
loggerxx 
.xx 
LogInformationxx %
(xx% &
$strxx& M
,xxM N
idxxO Q
)xxQ R
;xxR S
returnyy 
NotFoundyy 
(yy  
)yy  !
;yy! "
}zz 
logger|| 
.|| 
LogInformation|| !
(||! "
$str||" C
,||C D
id||E G
)||G H
;||H I
return~~ 
Ok~~ 
(~~ 
calendar~~ 
)~~ 
;~~  
} 	
catch
ÄÄ 
(
ÄÄ )
UnauthorizedAccessException
ÄÄ *
ex
ÄÄ+ -
)
ÄÄ- .
{
ÅÅ 	
logger
ÇÇ 
.
ÇÇ 

LogWarning
ÇÇ 
(
ÇÇ 
ex
ÇÇ  
,
ÇÇ  !
$str
ÇÇ" >
)
ÇÇ> ?
;
ÇÇ? @
return
ÉÉ 
Unauthorized
ÉÉ 
(
ÉÉ  
ex
ÉÉ  "
.
ÉÉ" #
Message
ÉÉ# *
)
ÉÉ* +
;
ÉÉ+ ,
}
ÑÑ 	
}
ÖÖ 
[
áá 
	Authorize
áá 
]
áá 
[
àà 

HttpDelete
àà 
(
àà 
$str
àà 
)
àà 
]
àà 
[
ââ "
ProducesResponseType
ââ 
(
ââ 
StatusCodes
ââ %
.
ââ% & 
Status204NoContent
ââ& 8
)
ââ8 9
]
ââ9 :
[
ää "
ProducesResponseType
ää 
(
ää 
StatusCodes
ää %
.
ää% &
Status404NotFound
ää& 7
)
ää7 8
]
ää8 9
[
ãã "
ProducesResponseType
ãã 
(
ãã 
StatusCodes
ãã %
.
ãã% &#
Status401Unauthorized
ãã& ;
)
ãã; <
]
ãã< =
public
åå 

async
åå 
Task
åå 
<
åå 
IActionResult
åå #
>
åå# $
DeleteCalendar
åå% 3
(
åå3 4
int
åå4 7
id
åå8 :
)
åå: ;
{
çç 
logger
éé 
.
éé 
LogInformation
éé 
(
éé 
$str
éé H
,
ééH I
id
ééJ L
)
ééL M
;
ééM N
try
êê 
{
ëë 	
var
íí 
email
íí 
=
íí 
User
íí 
.
íí !
GetUserEmailOrThrow
íí 0
(
íí0 1
)
íí1 2
;
íí2 3
var
ìì 
calendar
ìì 
=
ìì 
await
ìì  
calendarService
ìì! 0
.
ìì0 1!
DeleteCalendarAsync
ìì1 D
(
ììD E
id
ììE G
,
ììG H
email
ììI N
)
ììN O
;
ììO P
if
ïï 
(
ïï 
calendar
ïï 
==
ïï 
null
ïï  
)
ïï  !
{
ññ 
logger
óó 
.
óó 
LogInformation
óó %
(
óó% &
$str
óó& P
,
óóP Q
id
óóR T
)
óóT U
;
óóU V
return
òò 
NotFound
òò 
(
òò  
)
òò  !
;
òò! "
}
ôô 
logger
õõ 
.
õõ 
LogInformation
õõ !
(
õõ! "
$str
õõ" F
,
õõF G
id
õõH J
)
õõJ K
;
õõK L
return
ùù 
	NoContent
ùù 
(
ùù 
)
ùù 
;
ùù 
}
ûû 	
catch
üü 
(
üü )
UnauthorizedAccessException
üü *
ex
üü+ -
)
üü- .
{
†† 	
logger
°° 
.
°° 

LogWarning
°° 
(
°° 
ex
°°  
,
°°  !
$str
°°" A
)
°°A B
;
°°B C
return
¢¢ 
Unauthorized
¢¢ 
(
¢¢  
ex
¢¢  "
.
¢¢" #
Message
¢¢# *
)
¢¢* +
;
¢¢+ ,
}
££ 	
}
§§ 
}•• «
HC:\Users\micha\Projects\ESN-WebApi\Web\Attributes\ValidateIdAttribute.cs
	namespace 	
Web
 
. 

Attributes 
; 
public

 
class

 
ValidateIdAttribute

  
:

! "!
ActionFilterAttribute

# 8
{ 
private 
readonly 
string 
_parameterName *
;* +
public 

ValidateIdAttribute 
( 
string %
parameterName& 3
=4 5
$str6 :
): ;
{ 
_parameterName 
= 
parameterName &
;& '
} 
public 

override 
void 
OnActionExecuting *
(* +"
ActionExecutingContext+ A
contextB I
)I J
{ 
if 

( 
context 
. 
ActionArguments #
.# $
TryGetValue$ /
(/ 0
_parameterName0 >
,> ?
out@ C
varD G
valueH M
)M N
)N O
{ 	
if 
( 
value 
is 
int 
id 
&&  "
id# %
<=& (
$num) *
)* +
{ 
context 
. 
Result 
=  
new! $"
BadRequestObjectResult% ;
(; <
new< ?
{ 
error 
= 
$" 
$str &
{& '
_parameterName' 5
}5 6
"6 7
,7 8
message 
= 
$"  
$str  $
{$ %
_parameterName% 3
}3 4
$str4 b
"b c
} 
) 
; 
return 
; 
} 
}   	
base"" 
."" 
OnActionExecuting"" 
("" 
context"" &
)""& '
;""' (
}## 
}$$ 